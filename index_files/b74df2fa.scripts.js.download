"use strict";function setCookie(a,b,c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="expires="+d.toGMTString();document.cookie=a+"="+b+"; "+e}function getCookie(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){var e=c[d].trim();if(0===e.indexOf(b))return e.substring(b.length,e.length)}return""}function replaceAll(a,b,c){for(var d=a,e=d.indexOf(b);e!==-1;)d=d.substring(0,e)+c+d.substring(e+b.length,d.length),e=d.indexOf(b,e+c.length);return d}function setMissedHeartbeatsLimitToMax(){missedHeartbeatsLimit=missedHeartbeatsLimitMax}function getData(a,b,c){var d={method:a,args:b};c&&(callback=c),setMissedHeartbeatsLimitToMax(),webSocket.send(JSON.stringify(d))}function getCookie(a){var b,c,d=a+"=",e=document.cookie.split(";");for(b=0;b<e.length;b++){for(c=e[b];" "===c.charAt(0);)c=c.substring(1);if(0===c.indexOf(d))return c.substring(d.length,c.length)}return""}function getLocale(){var a=getCookie("egovLang");return""!==a?a:"kk"}function findSubjectAttr(a,b){var c,d;for(d=0;d<a.length;d++)if(c=a[d].replace(/^\s\s*/,"").replace(/\s\s*$/,""),0===c.indexOf(b+"="))return c.substr(b.length+1);return null}function hideChooseNCLayerModal(){document.getElementById("signSelCertBtnsPnl").style.display="",document.getElementById("chooseNCLayerModal").style.display="none"}function openDialog(){hideChooseNCLayerModal(),document.getElementById("NCALayerNotConnected").style.display=""}function setMissedHeartbeatsLimitToMin(){missedHeartbeatsLimit=missedHeartbeatsLimitMin}function pingLayer(){try{webSocket.send(heartbeatMsg)}catch(a){clearInterval(heartbeatInterval),heartbeatInterval=null,webSocket.close()}}function initNCALayer(a){webSocket=new WebSocket("wss://127.0.0.1:13579/"),webSocket.onopen=function(){null===heartbeatInterval&&(missedHeartbeats=0,heartbeatInterval=setInterval(pingLayer,2e3)),a&&window[a]()},webSocket.onclose=function(a){a.wasClean,openDialog()},webSocket.onmessage=function(a){var b,c;return a.data===heartbeatMsg?void(missedHeartbeats=0):(b=JSON.parse(a.data),c={result:b.result,secondResult:b.secondResult,errorCode:b.errorCode,getResult:function(){return this.result},getSecondResult:function(){return this.secondResult},getErrorCode:function(){return this.errorCode}},callback&&window[callback](c),void setMissedHeartbeatsLimitToMin())}}function hideNCALayerNotConnectedModal(){document.getElementById("NCALayerNotConnected").style.display="none"}function hideNCAPasswordModal(){document.getElementById("NCApassModal").style.display="none",document.getElementById("signNCAWrongPassword").style.display="none",document.getElementById("signNCAEmptyPassword").style.display="none",document.getElementById("signNCATryPanel").style.display="none",document.getElementById("signNCAUnknownErrorPanel").style.display="none",document.getElementById("signNCANoCertsInStoreAuth").style.display="none",document.getElementById("signNCANoCertsInStoreSign").style.display="none",document.getElementById("techErrorNCA").style.display="none",document.getElementById("signNCABlock").style.display="none",document.getElementById("signNCAPassword").value=""}function hideChooseKeyModal(){document.getElementById("chooseKeyModal").style.display="none"}function resetInputs(){document.getElementById("storageAlias").value="",document.getElementById("storagePath").value="",document.getElementById("password").value="",document.getElementById("keyAlias").value=""}function ncaLayerErrorCloseAll(){resetInputs(),hideNCALayerNotConnectedModal(),hideNCAPasswordModal(),hideChooseKeyModal()}function hideNCALayerError(){document.getElementById("NCALayerError").style.display="none"}function resetSignModal(){document.getElementById("personInfo").style.display="none"}function prepareModals(){ncaLayerErrorCloseAll(),""!==document.getElementById("personInfo").style.display&&(document.getElementById("signSelCertBtnsPnl").style.display="")}function openNcaLayerError(){ncaLayerErrorCloseAll(),document.getElementById("NCALayerError").style.display=""}function signXmlBack(a){var b,c=[];"NONE"===a.errorCode?(b=a.getResult(),c.push(b),document.getElementById("signedXml").value=JSON.stringify(c),angular.element(document.getElementById(cntrl)).scope().sendSignedXml()):"WRONG_PASSWORD"===a.errorCode&&a.result>-1?openNcaLayerError():("WRONG_PASSWORD"===a.errorCode,openNcaLayerError())}function signXmlCall(a){var b,c=JSON.parse(document.getElementById("xmlToSign").value),d=$("#storageAlias").val(),e=$("#storagePath").val(),f=$("#password").val(),g=$("#keyAlias").val(),h=[];if(e&&d&&f&&g&&c)if(c.length>1)for(b=0;b<c.length;b++)h=[d,e,g,f,c[b]],getData("signXml",h,a);else h=[d,e,g,f,c[0]],getData("signXml",h,a);else openNcaLayerError()}function selectNCAStore(){document.getElementById("personInfo").style.display="none",setTimeout(function(){getData("loadSlotList",["AKKaztokenStore"],"selectNCAStoreKazCallback")},500)}function chooseNCAStorage(a){var b=document.getElementById("storagePath").value,c=[a,"P12",b];hideChooseNCLayerModal(),document.getElementById("storageAlias").value=a,getData("browseKeyStore",c,"chooseNCAStorageBack")}function showNCAStore(){var a,b="",c="PKCS12",d="AKKaztokenStore",e="AKKZIDCardStore",f=getLocale()||"ru",g={kk:"Жеке куәлік",ru:"Удостоверение личности"},h={kk:"Файлды таңдау",ru:"Выбрать файл"},i="ng-modal-button ng-modal-button--green ng-modal-button--full";kTokensNclayer||idCardNclayer?(a=document.getElementById("selectCertNCLayerStore"),kTokensNclayer&&(b+="<button type='button' class='"+i+"' onclick='chooseNCAStorage(\""+d+"\")'>KazToken</button>"),idCardNclayer&&(b+="<button type='button' class='"+i+"' onclick='chooseNCAStorage(\""+e+"\")'>"+g[f]+"</button>"),b+="<button type='button' class='"+i+"' onclick='chooseNCAStorage(\""+c+"\")'>"+h[f]+"</button>",a.innerHTML=b,document.getElementById("signSelCertBtnsPnl").style.display="none",document.getElementById("chooseNCLayerModal").style.display=""):chooseNCAStorage(c)}function selectNCAStoreIdCallback(a){idCardNclayer="NONE"===a.getErrorCode(),showNCAStore()}function selectNCAStoreKazCallback(a){kTokensNclayer="NONE"===a.getErrorCode(),setTimeout(function(){getData("loadSlotList",["AKKZIDCardStore"],"selectNCAStoreIdCallback")},500)}function openNCAPasswordModal(){document.getElementById("NCApassModal").style.display=""}function chooseNCAStorageBack(a){var b=document.getElementById("storagePath").value;"NONE"===a.getErrorCode()?(b=a.getResult(),null!==b&&""!==b&&"undefined"!=typeof b?(document.getElementById("storagePath").value=b,openNCAPasswordModal()):(document.getElementById("storageAlias").value="",document.getElementById("storagePath").value="")):(document.getElementById("storageAlias").value="",document.getElementById("storagePath").value="")}function keysOptionChanged(){var a=document.getElementById("keys").options[document.getElementById("keys").selectedIndex].text,b=a.split("|")[3];document.getElementById("keyAlias").value=b}function fillPersonData(a){var b=a.result,c=b.split(","),d=findSubjectAttr(c,"SERIALNUMBER").substr(3),e=findSubjectAttr(c,"E"),f=findSubjectAttr(c,"CN"),g=f.split(" "),h=g[0]||"",i=g[1]||"",j=findSubjectAttr(c,"G");j=j||"",document.getElementById("signIIN").innerHTML=d,document.getElementById("signEmail").innerHTML=e,document.getElementById("signSurName").innerHTML=h,document.getElementById("signName").innerHTML=i,document.getElementById("signMName").innerHTML=j}function fillOrgData(a){var b=a.result.split(","),c=findSubjectAttr(b,"OU"),d=findSubjectAttr(b,"O");null!==c?(c.length>3&&(c=c.substr(3)),document.getElementById("signBINRow").style.display="",document.getElementById("signOrgNameRow").style.display="",document.getElementById("signBIN").innerHTML=c,document.getElementById("signOrgName").innerHTML=replaceAll(d,'\\"','"')):(document.getElementById("signBINRow").style.display="none",document.getElementById("signOrgNameRow").style.display="none")}function getNotAfterCall(){var a=document.getElementById("storageAlias").value,b=document.getElementById("storagePath").value,c=document.getElementById("password").value,d=document.getElementById("keyAlias").value,e=[];b&&a&&c&&d?(e=[a,b,d,c],getData("getNotAfter",e,"getNotAfterBack")):openNcaLayerError()}function getNotAfterBack(a){var b;"NONE"===a.errorCode?(b=a.result.split(" ")[0],document.getElementById("endDate").innerHTML=b):openNcaLayerError()}function getNotBeforeBack(a){var b;"NONE"===a.errorCode?(b=a.result.split(" ")[0],document.getElementById("beginDate").innerHTML=b,getNotAfterCall()):openNcaLayerError()}function getNotBeforeCall(){var a=document.getElementById("storageAlias").value,b=document.getElementById("storagePath").value,c=document.getElementById("password").value,d=document.getElementById("keyAlias").value,e=[];b&&a&&c&&d?(e=[a,b,d,c],getData("getNotBefore",e,"getNotBeforeBack")):openNcaLayerError()}function getSubDNBack(a){"NONE"===a.errorCode?(fillPersonData(a),fillOrgData(a),document.getElementById("personInfo").style.display="",document.getElementById("signBtnsPnl").style.display="",document.getElementById("signSelCertBtnsPnl").style.display="none",getNotBeforeCall()):openNcaLayerError()}function getSubDN(){var a=document.getElementById("keyAlias").value,b=document.getElementById("password").value,c=document.getElementById("storagePath").value,d=document.getElementById("storageAlias").value,e=[];c&&d&&b&&a?(e=[d,c,a,b],getData("getSubjectDN",e,"getSubDNBack")):openNcaLayerError()}function selectNCLayerKey(){hideChooseKeyModal(),getSubDN()}function setNCAPasswordBack(a){var b,c,d,e=document.getElementById("keys");if("NONE"===a.errorCode){for(e.options.length=0,c=a.result,b=c.split("\n"),d=0;d<b.length;d++)null!==b[d]&&""!==b[d]&&(e.options[e.length]=new Option(b[d],d));keysOptionChanged(),hideNCAPasswordModal(),1===b.length?getSubDN():document.getElementById("chooseKeyModal").style.display=""}else{if(document.getElementById("modalNCAInfo").style.display="","WRONG_PASSWORD"===a.errorCode&&a.result>-1)document.getElementById("signNCAWrongPassword").style.display="inline",document.getElementById("signNCATryPanel").style.display="inline",document.getElementById("signNCATries").innerHTML=a.result;else if("WRONG_PASSWORD"===a.errorCode)document.getElementById("signNCAWrongPassword").style.display="inline";else if("EMPTY_KEY_LIST"===a.errorCode){var f=document.getElementById("keyType").value;f&&"AUTH"===f?document.getElementById("signNCANoCertsInStoreAuth").style.display="inline":f&&"SIGN"===f?document.getElementById("signNCANoCertsInStoreSign").style.display="inline":document.getElementById("techErrorNCA").style.display="inline"}else document.getElementById("signNCAUnknownErrorPanel").style.display="inline",document.getElementById("signNCAErrorCode").innerHTML=a.errorCode;e.options.length=0}}function setNCAPassword(){var a=document.getElementById("storageAlias").value,b=document.getElementById("signNCAPassword").value,c=document.getElementById("storagePath").value,d=document.getElementById("keyType").value,e=[];document.getElementById("password").value=b,c&&a?b?(e=[a,c,b,d],getData("getKeys",e,"setNCAPasswordBack")):(document.getElementById("modalNCAInfo").style.display="",document.getElementById("signNCAEmptyPassword").style.display="inline"):openNcaLayerError()}function selectSignType(){resetInputs(),null===webSocket||3===webSocket.readyState||2===webSocket.readyState?initNCALayer("selectNCAStore"):selectNCAStore()}function doSignRequest(a){cntrl=a,cntrl||console.log("Проблемы с контроллером!"),signXmlCall("signXmlBack")}function createCookie(a,b,c){var d,e;c?(d=new Date,d.setTime(d.getTime()+24*c*60*60*1e3),e="; expires="+d.toGMTString()):e="",document.cookie=a+"="+b+e+"; path=/"}function eraseCookie(a){createCookie(a,"",-1)}function changeLocale(a){eraseCookie("sso-lang"),createCookie("sso-lang",a,1),location.reload()}function getPlaceId(){var a="KVExtension",b="EGOV_CLIENT_ID";return sessionStorage.getItem(a+b)}var app,baseUrl,idpUrl,idpRestUrl,dialogUrl,isDeveloperMode=!1;angular.module("jm.i18next").config(["$i18nextProvider",function(a){return a.options={preload:["kk","ru"],lngWhitelist:["kk","ru"],fallbackLng:["kk","ru"],useCookie:!0,cookieName:"egovLang",cookieDomain:".egov.kz",useLocalStorage:!1,resGetPath:"locales/__lng__/__ns__.json"}}]),app=angular.module("myegovApp",["ui.router","restangular","jm.i18next","ui.select","ngSanitize","ui.bootstrap.bindHtml","ui.bootstrap.tooltip","ui.bootstrap.position","ngCookies","duScroll","angularFileUpload","ngImgCrop","ngAria","ngWebsocket","chart.js","angularMoment","ui.mask"]),app.config(["ChartJsProvider",function(a){a.setOptions({responsive:!0,datasetFill:!1,scaleBeginAtZero:!1})}]),app.value("duScrollOffset",30),isDeveloperMode?(idpUrl=window.location.protocol+"//idp.timwe.nitec.kz/idp/login",idpRestUrl=window.location.protocol+"//idp.timwe.nitec.kz/idp/rest/",baseUrl=window.location.protocol+"//my.local.nitec.kz",dialogUrl=window.location.protocol+"//dialog.bee.nitec.kz"):(idpUrl=window.location.protocol+"//idp.egov.kz/idp/login",idpRestUrl=window.location.protocol+"//idp.egov.kz/idp/rest/",baseUrl=window.location.protocol+"//my.egov.kz",dialogUrl=window.location.protocol+"//dialog.egov.kz"),app.run(["$rootScope","$state","$stateParams","$websocket","$interval","$timeout","$window",function(a,b,c,d,e,f,g){var h;h="https:"===g.location.protocol?d.$new({url:"wss://my.egov.kz/person-profile-notifly/websocket/notifly",reconnect:!0,reconnectInterval:6e3,protocols:[]}):d.$new({url:"ws://my.egov.kz/person-profile-notifly/websocket/notifly",reconnect:!0,reconnectInterval:6e3,protocols:[]}),h.$on("$open",function(){e(function(){h.$emit("ping")},3e5)}),h.$on("message",function(c){"SUCCESS"===c.code?f(function(){toastr.success(i18n.translate("updateSuccess",{postProcess:"sprintf",sprintf:[i18n.translate(c.service)]}),"",{timeOut:15e3}),b.is("profile.individualEntity")?a.$broadcast("fetchServiceByName",c.service):b.is("profile.legalEntity")&&a.$broadcast("fetchLegalServiceByName",c.service)},1e3):"ERROR"===c.code?(toastr.error(i18n.translate("updateErrorWS",{postProcess:"sprintf",sprintf:[i18n.translate(c.service)]}),"",{timeOut:15e3}),b.is("profile.individualEntity")?a.$broadcast("fetchServiceByName",c.service):b.is("profile.legalEntity")&&a.$broadcast("fetchLegalServiceByName",c.service)):"IN_PROGRESS"===c.code&&toastr.info(i18n.translate("updateInProgressWS",{postProcess:"sprintf",sprintf:[i18n.translate(c.service)]}),"",{timeOut:15e3})}),h.$on("fetch",function(b){a.$broadcast("fetchServiceByName",b.service)}),h.$on("$close",function(){})}]),app.config(["$stateProvider","$urlRouterProvider",function(a,b){return b.otherwise("/"),a.state("profile",{url:"/",templateUrl:"views/profile.html",controller:"ProfileController",data:{pageTitle:"routes.privateCabinet"}}).state("profile.individualEntity",{templateUrl:"views/individual-entity.html",controller:"IndividualController"}).state("profile.legalEntity",{templateUrl:"views/legal-entity.html",controller:"LegalEntityController"}).state("inbox",{url:"/inbox",templateUrl:"/views/inbox/inbox.html",controller:"InboxMainController",controllerAs:"vm"}).state("inbox.all",{url:"/all?page&queryText",templateUrl:"/views/inbox/inbox.all.html",controller:"InboxAllController",controllerAs:"vm",data:{pageTitle:"routes.inbox.all"}}).state("inbox.requests",{"abstract":!0,url:"/requests",template:"<ui-view/>",data:{pageTitle:"routes.inbox.requests"}}).state("inbox.requests.all",{url:"/all?page&queryText",templateUrl:"/views/inbox/requests/list.html",controller:"InboxRequestsController"}).state("inbox.requests.source",{url:"/:sourceSystemId?page&queryText",templateUrl:"/views/inbox/requests/list.html",controller:"InboxRequestsController"}).state("inbox.request",{url:"/request/:requestId",templateUrl:"/views/inbox/requests/detail.html",controller:"RequestController",data:{pageTitle:"routes.inbox.request"}}).state("inbox.notifications",{"abstract":!0,url:"/notifications",template:"<ui-view/>",data:{pageTitle:"routes.inbox.notifications"}}).state("inbox.notifications.all",{url:"/all?page&queryText",templateUrl:"/views/inbox/notifications/list.html",controller:"InboxNotificationsController"}).state("inbox.notifications.agency",{url:"/:govAgencyId?page&queryText",templateUrl:"/views/inbox/notifications/list.html",controller:"InboxNotificationsController"}).state("inbox.notification",{url:"/notification/:notificationId",templateUrl:"/views/inbox/notifications/detail.html",controller:"NotificationController",data:{pageTitle:"routes.inbox.notification"}}).state("inbox.payments",{"abstract":!0,url:"/payments",template:"<ui-view/>",data:{pageTitle:"routes.inbox.payments"}}).state("inbox.payments.all",{url:"/all?page&queryText",templateUrl:"/views/inbox/payments/list.html",controller:"InboxPaymentAllController"}).state("inbox.payment",{url:"/payment/:paymentId",templateUrl:"/views/inbox/payments/detail.html",controller:"PaymentController",data:{pageTitle:"routes.inbox.payment"}}).state("inbox.archived",{"abstract":!0,url:"/archived",template:"<ui-view/>",data:{pageTitle:"routes.inbox.archived"}}).state("inbox.archived.all",{url:"/all?page&queryText",templateUrl:"/views/inbox/notifications/list.html",controller:"InboxArchivedAllController"}).state("inbox.archive",{url:"/archived/:archivedId",templateUrl:"/views/inbox/notifications/detail.html",controller:"ArchivedController",data:{pageTitle:"routes.inbox.archived"}}).state("confirm-email",{url:"/confirm/email/:confirmationCode",templateUrl:"views/contact-confirm.html",controller:"EmailConfirmationController"}).state("settings",{url:"/settings",templateUrl:"views/settings.html",controller:"SettingsController",data:{pageTitle:"routes.settings"}}).state("digi-docs",{url:"/digidocs",templateUrl:"views/digidocs.html",data:{pageTitle:"routes.digidocs"}}).state("my-documents",{url:"/mydocs?page&start&end&parent&type&attribute",templateUrl:"../views/mydoc/mydocuments.html",controller:"MyDocumentsController as vm",data:{pageTitle:"routes.mydocs"}}).state("warning",{url:"/warning",templateUrl:"views/warning.html",data:{pageTitle:"routes.warning"}}).state("lp-not-found",{url:"/lp-not-found",templateUrl:"views/legal-profile-notfound.html",data:{pageTitle:"routes.privateCabinet"}}).state("access-control",{url:"/access-control",templateUrl:"views/legal-access-control.html",controller:"AccessControlController",data:{pageTitle:"restriction.access"}}).state("no-access",{url:"/no-access",templateUrl:"views/no-access.html",data:{pageTitle:"routes.noAccess"}}).state("profile-disabled",{url:"/profile-disabled",templateUrl:"views/profile-disabled.html",data:{pageTitle:"routes.profileDisabled"}})}]),app.run(["$rootScope","$state","$stateParams","$i18next",function(a,b,c){return a.$state=b,a.$stateParams=c}]),app.directive("popupToggle",function(){return function(a,b){return event.preventDefault(),event.stopPropagation(),$(b).on("click",function(){return $(b).toggleClass("selected popup-state-opened")})}}),app.directive("inboxTitleCheckbox",function(){return function(a,b){return event.preventDefault(),event.stopPropagation(),$(b).on("click",function(){return $(b).children(".inbox-item-hidden-checkbox").click()})}}),app.directive("ngEnter",function(){return function(a,b,c){return b.bind("keydown keypress",function(b){if(13===b.which)return a.$apply(function(){return a.$eval(c.ngEnter)}),b.preventDefault()})}}),app.directive("childSelect",function(){return function(a,b){return b.bind("click",function(){return b.toggleClass("is-selected")})}}),app.directive("clickOff",["$parse","$document",function(a,b){return{compile:function(c,d){var e=a(d.clickOff);return function(a,c){c.bind("click",function(a){a.stopPropagation()}),angular.element(b[0].body).bind("click",function(b){a.$apply(function(){e(a,{$event:b})})})}}}}]),app.directive("collapseWhen",["$timeout",function(a){return function(b,c,d){a(function(){var a=0,e=0,f=0;b.$watch(d.collapseWhen,function(b){a=angular.element(c).find(".js_collapse-item").height(),e=a?a+20:280,f=b?e+"px":"100%",$(c).css("height",f)},!0)})}}]),app.directive("checkSubscribeCheckbox",function(){return{scope:{subscriptions:"=subscriptions",ngModel:"=ngModel",notification:"=notification",channelId:"=channelId",checkedCounter:"=checkedCounter",channelType:"=channelType",totalCounter:"=totalCounter",allChecked:"=allChecked"},link:function(a){function b(b){b.length&&a.notification?_.find(b,function(c,d){return c.notificationTypeId===a.notification.id&&c.channelId===a.channelId?(a.checkedCounter[c.channelType]++,a.ngModel=!0,!0):void(d===b.length-1&&(a.ngModel=!1))}):0===b.length?a.ngModel=!1:toastr.error(i18n.translate("profile.error110")),a.allChecked[a.channelType]=a.totalCounter[a.channelType]<=a.checkedCounter[a.channelType]}a.ngModel=!1,a.$watch("subscriptions",b)}}}),app.directive("cnType",function(){return{scope:{channelsLength:"=channelsLength",notificationTypeId:"=notificationTypeId",subscriptions:"=subscriptions",enabled:"=ngModel"},link:function(a){a.$watch("subscriptions",function(b){var c,d=0;if(a.enabled=!1,void 0!==b&&null!==b&&""!==b)for(c=0;c<b.length;c++)b[c].notificationType.id===a.notificationTypeId&&d++;d>0&&(a.enabled=!0)})}}}),app.directive("ngFileSelectClear",["$timeout",function(a){return{link:function(b,c){a(function(){var a=$(c).find("input");a.on("change",function(){a.wrap("<form>").closest("form").get(0).reset(),a.unwrap()})},0)}}}]),app.directive("focusMe",["$timeout",function(){return{scope:{trigger:"=focusMe"},link:function(a,b){a.$watch("trigger",function(a){a===!0&&b[0].focus()})}}}]),function(){function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a){var c="/surveys/rest/v1/all/surveys/"+a+"?mode=full";l.one(c).get().then(function(a){a&&(b.poll.resultShow=!0,b.pollResult=a),b.poll.loading=!1})}function p(a){var c="/surveys/rest/v1/all/surveys/"+a+"?mode=full";b.poll.resultShow=!1,l.one(c).get().then(function(a){a&&(b.question=a),b.poll.loading=!1})}function q(){var a="/surveys/rest/v1/all/surveys/my",c={status:"PUBLISHED",type:"LK",page:b.poll.page,actionType:"PREVIEWED",limit:b.poll.limit};b.poll.loading=!0,b.poll.answer="",l.one(a).get(c).then(function(a){var c,d=[];if(a)if(a.surveyCount>0){for(b.poll.questionPermission=!0,b.poll.counter=a.surveyCount,b.poll.current=0,b.poll.pageCount=a.pageCount,b.poll.totalNumb=a.surveys.length,c=0;c<a.surveys.length;c++)d.push(a.surveys[c].id);b.surveysArr=d,p(d[b.poll.current])}else b.poll.questionPermission=!1})}function r(b){g.options.lng=b,f.currentLanguage=b,a.changeLocale(b),moment.locale(b)}function s(a){var b,c="",d=new Uint8Array(a),e=d.byteLength;for(b=0;b<e;b++)c+=String.fromCharCode(d[b]);return k.btoa(c)}var t=c.one("one-inbox/rest-v2/search/unread-count");b.surveysArr=[],b.print=function(){k.print()},b.accessibility={propertyObject:c.one("nss/rest-v2/settings/property"),accessObject:c.one("nss/rest-v2/settings/property"),getZoom:function(){var a=this;a.propertyObject.get({key:["ZOOM"]}).then(function(b){null!==b.property?a.zoomed=b.property.value:a.zoomed=0})},notSaveZoom:function(a){this.zoomed=a},getContrast:function(){var a=this;a.propertyObject.get({key:["CONTRAST"]}).then(function(c){null!==c.property?(a.highContrast="true"===c.property.value,b.highContrastModel="true"===c.property.value):(a.highContrast=!1,b.highContrastModel=!1)})},notSaveContrast:function(){var a=this;a.highContrast=!a.highContrast,b.highContrastModel=!b.highContrastModel},contrast:function(a){var c=this;c.accessObject.put({key:"CONTRAST",value:a}).then(function(a){110===a.responseInfo.code?b.accessibility.getContrast():c.notSaveContrast()})},getInvert:function(){var a=this;a.propertyObject.get({key:["INVERT"]}).then(function(c){null!==c.property?(a.invertData="true"===c.property.value,b.invertModel="true"===c.property.value):(a.invertData=!1,b.invertModel=!1)})},notSaveInvert:function(){this.invertData=!this.invertData,b.invertModel=!b.invertModel},invert:function(a){var c=this;c.accessObject.put({key:"INVERT",value:a}).then(function(){b.accessibility.getInvert()})},zoom:function(a){var c=this;c.accessObject.put({key:"ZOOM",value:a}).then(function(d){110===d.responseInfo.code?b.accessibility.getZoom():c.notSaveZoom(a),m(function(){angular.element(k).triggerHandler("resize")})})},logout:function(){this.invert(!1),this.zoom(!1),this.contrast(!1)}},b.accessibility.getZoom(),b.accessibility.getContrast(),b.accessibility.getInvert(),b.poll={resultShow:!1,counter:0,current:0,questionPermission:!1,loading:!1,page:1,limit:20},b.savePoll=function(a,c){var d="/surveys/rest/v1/all/results/",e={};a.answer?(b.poll.loading=!0,e={surveyId:c,userAnswers:[{answerId:Number(a.answer)}]},l.all(d).post(e).then(function(a){"saved"===a.result?(o(c),b.poll.counter--,b.poll.answer=""):b.poll.loading=!1})):toastr.error(i18n.translate("survey.errorNoAnswer"))},b.nextSurvey=function(){b.poll.answer="",b.poll.loading=!0,b.question=[],b.poll.current<b.poll.totalNumb-1?(b.poll.current++,p(b.surveysArr[b.poll.current])):(b.poll.page=b.poll.pageCount>b.poll.page?b.poll.page+1:1,q())},b.mainUI={egovMenuVisible:!1,egovMenuShown:!1,mobileMenu:!1,toggleMenu:function(){angular.element(k).width()<=960&&(this.mobileMenu=!this.mobileMenu),this.survey.isVisible&&this.survey.toggle()},survey:{isVisible:!1,toggle:function(){this.isVisible=!this.isVisible,!this.isVisible&&b.poll.resultShow?(b.poll.resultShow=!1,b.poll.counter<1&&(b.poll.counter=0,b.poll.questionPermission=!1)):q()}}},f.inboxMessagesMouseover=!1,b.showGlobalLoader=function(){f.globalLoader=!0},b.hideGlobalLoader=function(){f.globalLoader=!1},b.languages=["kk","ru"],f.currentLanguage=k.i18n&&k.i18n.lng()&&(k.i18n.lng()===b.languages[0]||k.i18n.lng()===b.languages[1])?k.i18n.lng():b.languages[0],r(f.currentLanguage),b.changeLanguage=function(a){r(a)},b.modalVisible=!1,b.changeEmail=function(){d.go("profile.individualEntity",{changeEmail:!0})},f.checkMyDocs=function(){c.one("mydocs/rest-v2/check").get().then(function(a){100!==a.code&&(f.myDocsPermission=!1)})},f.checkNss=function(){c.one("nss/rest-v2/settings/check").get().then(function(a){100!==a.code&&(f.settingPermission=!1)})},f.checkOneInBox=function(){c.one("one-inbox/rest-v2/search/check").get().then(function(a){100!==a.code&&(f.oneInBoxPermission=!1)})},f.initialize=function(){f.settingPermission=!0,f.oneInBoxPermission=!0,f.myDocsPermission=!0},f.profileDisabled=!1,c.one("person-profile/rest-v2/profile/check-user").get().then(function(a){f.initialize(),f.checkMyDocs(),"BIN"===a?(c.one("legal-profile/rest/check-profile-disabled").get().then(function(){}),c.one("legal-profile/rest/entrance-sync").get().then(function(){}),f.checkNss(),f.checkOneInBox(),f.isLegal=!0):(q(),c.one("person-profile/rest-v2/profile/check-profile-disabled").get().then(function(){}),c.one("person-profile/rest-v2/profile/entrance-sync").get().then(function(){}),f.isLegal=!1)}),toastr.options={positionClass:"toast-top-right",timeOut:4e3},b.test="../images/male.png",b.avatar={avatarObject:c.one("person-profile/rest-v2/profile/avatar"),status:"empty",progress:"",url:"person-profile/rest-v2/profile/avatar",src:"",raw:"",cropped:"",isOpen:!1,get:function(){var a=this;a.avatarObject.get().then(function(c){c.imageBase64&&c.imageBase64.length>10&&100===c.responseInfo.code?(b.avatar.refresh("image/jpg",c.imageBase64),a.status="success"):b.avatar.refresh("image/png","../images/male.png")})},remove:function(){var a=this;a.avatarObject.remove().then(function(b){100===b.code&&"success"===a.status?(toastr.success(i18n.translate("profile.deletePhotoInfo")),a.status="empty",a.src=""):"empty"===a.status?toastr.info(i18n.translate("profile.nothingToDeleteInfo")):toastr.error(i18n.translate("profile.connectionProblemInfo"))})},refresh:function(a,b){this.src="data:"+a+";base64,"+b},cancel:function(){this.isOpen=!1},save:function(){var a=this,c=a.cropped.substr(22);a.isOpen=!1,j.http({url:baseUrl+"/"+a.url,headers:{"Content-Type":"application/json"},method:"POST",data:{image:c}}).progress(function(c){b.$emit("showGlobalLoader"),a.status="progress",a.progress=parseInt(100*c.loaded/c.total,10)}).success(function(d){b.$emit("hideGlobalLoader"),100===d.code?(b.avatar.refresh("image/png",c),a.status="success",toastr.success(i18n.translate("profile.savePhotoInfo"))):(a.status="error",toastr.error(i18n.translate("profile.notSupportSizeInfo")))}).error(function(){a.status="error",toastr.error(i18n.translate("profile.internetProblemInfo"))})},select:function(a){var c=this,d=new FileReader,e=a[0];!e||"image/jpeg"!==e.type&&"image/png"!==e.type?(toastr.error(i18n.translate("profile.notSupportFormatInfo")),c.status="error",b.avatar.get()):e.size<5242880?(d.readAsArrayBuffer(e),d.onload=function(a){var d=s(a.target.result);c.raw="data:"+e.type+";base64,"+d,b.$apply(function(){c.isOpen=!0})}):(toastr.error(i18n.translate("profile.notSupportSizeInfo")),c.status="error",b.avatar.get())}},b.avatar.get(),b.logout=function(){b.$emit("showGlobalLoader"),i.get(baseUrl+"/person-profile/logout").success(function(){n.cookie="SSO=;path=/; domain=.egov.kz; expires=Sat, 01-Jan-1970 00:00:00 GMT",n.cookie="JSESSIONIDSSO=;path=/; domain=.my.egov.kz; expires=Sat, 01-Jan-1970 00:00:00 GMT",n.cookie="JSESSIONID=;path=.my.egov.kz;expires=Sat, 01-Jan-1970 00:00:00 GMT",n.cookie="recommender=",location.href="/"})},b.portalHeaderLinks=[{href:"//egov.kz/wps/poc?uri=mjnpa:index&language="+f.currentLanguage,caption:"legislation"},{href:"//idp.egov.kz/idp/r?ts=ELICENSE&url=http://elicense.kz/",caption:"eLicensing"},{href:"https://idp.egov.kz/idp/r?ts=KNP&url=https://cabinet.salyk.kz/sonoweb/content/personalCab.faces",caption:"taxpayerCabinet"},{href:"//open.egov.kz/",caption:"openGovernment"},{href:"//dialog.egov.kz/",caption:"govBlogs"},{href:"//egov.kz/wps/myportal/P13.01",caption:"receptionToMinister"},{href:"//egov.kz/wps/myportal/Esedo",caption:"citizensRequest"}],b.portalLinks=[{href:"//egov.kz/cms/categories/family",caption:"family"},{href:"//egov.kz/cms/categories/public_health",caption:"healthSystem"},{href:"//egov.kz/cms/categories/education",caption:"education"},{href:"//egov.kz/cms/categories/employment",caption:"employmentLabor"},{href:"//egov.kz/cms/categories/social",caption:"humanServices"},{href:"//egov.kz/cms/categories/migration",caption:"citizenship"},{href:"//egov.kz/cms/categories/house",caption:"realEstate"},{href:"//egov.kz/cms/categories/finance",caption:"taxesFinances"},{href:"//egov.kz/cms/categories/justice",caption:"legalAssistance"},{href:"//egov.kz/cms/categories/transports",caption:"transportCommunications"},{href:"//egov.kz/cms/categories/sport",caption:"tourismSport"},{href:"//egov.kz/cms/categories/military",caption:"milit"}],b.pooling=function(){t.get().then(function(a){b.unreadInboxCount=a.inboxUnreadCount,angular.element(".page").removeClass("page--loading")})},c.one("nss/rest-v2/settings/property").get({key:"INBOX_ITEM_LIMIT"}).then(function(a){a&&a.property&&a.property.value?f.inboxItemLimit=parseInt(a.property.value,10):f.inboxItemLimit=20}),b.$on("poolingEvent",b.pooling),b.$on("showGlobalLoader",b.showGlobalLoader),b.$on("hideGlobalLoader",b.hideGlobalLoader),f.modalSwitchOnProfile={isVisible:!1,show:function(){this.isVisible=!0},hide:function(){this.isVisible=!1},agree:function(){f.isLegal?f.switchOnLegalPersonProfile():f.switchOnLegalPersonProfile(),this.hide()}},f.modalDisableProfile={isVisible:!1,show:function(){this.isVisible=!0},hide:function(){this.isVisible=!1},agree:function(){f.isLegal?f.disableLegalPersonProfile():f.disablePersonProfile(),this.hide()}},b.pooling()}angular.module("myegovApp").controller("MainController",a),a.$inject=["amMoment","$scope","commonRestangular","$state","$stateParams","$rootScope","$i18next","$interval","$http","$upload","$window","pollRestangular","$timeout","$document"]}(),function(){function a(a,b,c){a.$emit("showGlobalLoader"),b.one("person-profile/rest-v2/profile/check-user").get().then(function(b){"BIN"===b?c.transitionTo("profile.legalEntity"):c.transitionTo("profile.individualEntity"),
a.$emit("hideGlobalLoader")})}angular.module("myegovApp").controller("ProfileController",a),a.$inject=["$scope","commonRestangular","$state"]}(),function(){function a(a,b,c,d,e,f,g,h){function i(a,b){this.begin=a,this.end=b,this.length=100}function j(b){return function(c){(c||0===c)&&(b[c]=!b[c]),angular.forEach(b,function(d,e){e!==c&&(b[e]=!1),(c||0===c)&&d&&(a.UI.state.anyDropdownOpen=!0),c||0===c||(a.UI.state.anyDropdownOpen=!1)})}}function k(){ga.get().then(function(b){100===b.responseInfo.code?(a.mbcPhone=b.mbcInfo,null!==b.mbcInfo.phone&&11===b.mbcInfo.phone.length&&"7"===b.mbcInfo.phone[0]&&(a.mbcPhone.phone=b.mbcInfo.phone.substr(1,11)),a.showPhone=!0,a.requestType="UPDATE",a.mbcPhone.notfound=!1,b.mbcInfo.isEnabled?a.mbcRequest="LOCK":a.mbcRequest="UNLOCK"):101===b.responseInfo.code?(a.mbcPhone.notfound=!0,a.requestType="REGISTER",a.showPhone=!1):(a.requestType="REGISTER",a.showPhone=!1,a.mbcPhone.notfound=!1)})}function l(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)}function m(a){var b;return angular.forEach(a,function(a){(a.issueDate||a.beginDate||a.techInspection)&&(a.issueDate=a.issueDate||a.beginDate||a.techInspection.inspectionDate,a.techInspection&&a.techInspection.expirationDate?a.expireDate=a.techInspection.expirationDate:a.expireDate=a.expireDate||a.endDate||"infinite",b=new i(a.issueDate,a.expireDate).getPositions(),"infinite"!==a.expireDate&&(a.expired=a.expireDate<new Date),a.indicatorPos=b.indicator,a.captionPos=b.caption,a.isVisible=b.isVisible)}),a}function n(){b.one("person-profile/rest-v2/profile/").get().then(function(b){null!==b.profile&&(g.isProfileEnabled=b.profile.enabled),a.$emit("hideGlobalLoader")})}function o(){ha.get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code?(a.mail=b.contact.value,a.fullContact=b.contact,a.showEmail=!0):a.showEmail=!1})}function p(){b.one("person-profile/rest-v2/profile/lvl").get().then(function(b){100===b.code&&(Number(b.requiredLvl)<=2?a.isSectionPermissionExist=!0:a.isSectionPermissionExist=!1,a.isEds=Number(b.requiredLvl)>=6)})}function q(){b.one("person-profile/rest-v2/profile/retirement-savings").get().then(function(b){var c,d,e=[],f=[];if(100===b.responseInfo.code||101===b.responseInfo.code){if(a.retirementSavings=b,a.series=[i18n.translate("profile.last6MonthPension")],null!==b.retirementSavingses){for(a.totalAmount=b.retirementSavingses.totalAmount,c=b.retirementSavingses.retirementSavingsList.length,d=c-1;d>=0;d--)e.push(b.retirementSavingses.retirementSavingsList[d].period),f.push(b.retirementSavingses.retirementSavingsList[d].amount);a.labels=e,a.data=[f],a.colours=[{fillColor:"rgba(30, 138, 98, 1.0000)"}],a.options={barValueSpacing:25,tooltipTemplate:"<%if (label){%><%}%><%= value %>"}}a.isRetirementSavingsSectionEnabled=!0,a.isRetirementSavingsSubsExist=!0}else 110===b.responseInfo.code?(a.isRetirementSavingsSectionEnabled=!0,a.isRetirementSavingsSubsExist=!0,a.retirementSavings=b):103===b.responseInfo.code?a.isRetirementSavingsSectionEnabled=!1:106===b.responseInfo.code?(a.isRetirementSavingsSubsExist=!1,a.isRetirementSavingsSectionEnabled=!1,a.isRetirementSavingsMenuShow=!0):102===b.responseInfo.code?a.isRetirementSavingsSectionOff=!0:a.isRetirementSavingsSectionEnabled=!1;a.$emit("hideGlobalLoader")})}function r(){b.one("person-profile/rest-v2/profile/individual-entrepreneur").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.individualEntrepreneur=b,a.isIndividualEntrepreneurSectionEnabled=!0,a.isIndividualEntrepreneurSubsExist=!0):103===b.responseInfo.code?a.isIndividualEntrepreneurSectionEnabled=!1:106===b.responseInfo.code?(a.isIndividualEntrepreneurSubsExist=!1,a.isIndividualEntrepreneurSectionEnabled=!1,a.isIndividualEntrepreneurMenuShow=!0):102===b.responseInfo.code?a.isIndividualEntrepreneurSectionOff=!0:a.isIndividualEntrepreneurSectionEnabled=!1,a.$emit("hideGlobalLoader")})}function s(){var c=window.location.search;a.showRefreshUserCardsList=!1,setTimeout(function(){a.showRefreshUserCardsList=!0},1e4),b.one("person-profile/rest-v2/profile/pshep-user-cards/"+("?needUserCardsUpdate=true"===c)).get().then(function(b){200===b.responseInfo.code&&(a.userCards=b.userCards.cards,a.userCards.updateInfo=b.updateInfo),a.isUserCardsEnabled=!0,a.isUserCardsSubsExist=!0,a.$emit("hideGlobalLoader")})}function t(){b.one("person-profile/rest-v2/profile/documents").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.documents=b,b&&m(b.documentList),a.isDocumentSectionEnabled=!0,a.isDocumentSubsExist=!0):103===b.responseInfo.code?a.isDocumentSectionEnabled=!1:106===b.responseInfo.code?(a.isDocumentSubsExist=!1,a.isDocumentSectionEnabled=!1,a.isDocumentMenuShow=!0):102===b.responseInfo.code?a.isDocumentSectionOff=!0:a.isDocumentSectionEnabled=!1,a.$emit("hideGlobalLoader")})}function u(){b.one("person-profile/rest-v2/profile/addresses").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(m(b.addressList),a.addresses=b,a.isAddressSectionEnabled=!0,a.isAddressSubsExist=!0):103===b.responseInfo.code?a.isAddressSectionEnabled=!1:106===b.responseInfo.code?(a.isAddressSectionEnabled=!1,a.isAddressSubsExist=!1,a.isAddressMenuShow=!0):102===b.responseInfo.code?a.isAddressSectionOff=!0:a.isAddressSectionEnabled=!1,a.$emit("hideGlobalLoader")})}function v(){b.one("person-profile/rest-v2/profile/driver-licenses").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(m(b.driverLicenseList),a.myDriverLicense=b,a.isDriverLicenseSectionEnabled=!0,a.isDriverLicenseSubsExist=!0):103===b.responseInfo.code?a.isDriverLicenseSectionEnabled=!1:106===b.responseInfo.code?(a.isDriverLicenseSubsExist=!1,a.isDriverLicenseSectionEnabled=!1,a.isDriverLicenseMenuShow=!0):102===b.responseInfo.code?a.isDriverLicenseSectionOff=!0:a.isDriverLicenseSectionEnabled=!1,a.$emit("hideGlobalLoader")})}function w(){b.one("person-profile/rest-v2/profile/accommodation-queue-new").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.accommodationQueue=b,a.isAccommodationQueueSectionEnabled=!0,a.isAccommodationQueueSubsExist=!0):103===b.responseInfo.code?a.isAccommodationQueueSectionEnabled=!1:106===b.responseInfo.code?(a.isAccommodationQueueSubsExist=!1,a.isAccommodationQueueSectionEnabled=!1,a.isAccommodationQueueMenuShow=!0):102===b.responseInfo.code?a.isAccommodationQueueSectionOff=!0:a.isAccommodationQueueSectionEnabled=!1,a.$emit("hideGlobalLoader")})}function x(){var c,d;b.one("person-profile/rest-v2/profile/licenses").get().then(function(b){100===b.responseInfo.code&&b.licenses.sort(function(a,b){return c=new Date(a.validityStartDate),d=new Date(b.validityStartDate),c<d?-1:c>d?1:0}),100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.licensesList=b,a.isLicenseSectionEnabled=!0,a.isLicenseSubsExist=!0):103===b.responseInfo.code?a.isLicenseSectionEnabled=!1:106===b.responseInfo.code?(a.isLicenseSubsExist=!1,a.isLicenseSectionEnabled=!1,a.isLicenseMenuShow=!0):102===b.responseInfo.code?a.isLicenseSectionOff=!0:a.isLicenseSectionEnabled=!1,a.$emit("hideGlobalLoader")})}function y(){b.one("person-profile/rest-v2/profile/debtor-register").get().then(function(b){null!==b.debtorRegisters&&(b.debtorRegisters.bansQty=_.filter(b.debtorRegisters,function(a){return a.banExist}).length),100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.debtorRegisterList=b,a.isDebtorRegisterSectionEnabled=!0,a.isDebtorRegisterSubsExist=!0):103===b.responseInfo.code?a.isDebtorRegisterSectionEnabled=!1:106===b.responseInfo.code?(a.isDebtorRegisterSubsExist=!1,a.isDebtorRegisterSectionEnabled=!1,a.isDebtorRegisterMenuShow=!0):102===b.responseInfo.code?a.isDebtorRegisterSectionOff=!0:a.isDebtorRegisterSectionEnabled=!1,a.$emit("hideGlobalLoader")})}function z(){b.one("person-profile/rest-v2/profile/health-passport").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.healthPassportResp=b,b&&(a.healthPassport=b.healthPassport),a.isHealthPassportSectionEnabled=!0,a.isHealthPassportSubsExist=!0):103===b.responseInfo.code?a.isHealthPassportSectionEnabled=!1:106===b.responseInfo.code?(a.isHealthPassportSubsExist=!1,a.isHealthPassportSectionEnabled=!1,a.isHealthPassportMenuShow=!0):102===b.responseInfo.code?a.isHealthPassportSectionOff=!0:a.isHealthPassportSectionEnabled=!1,a.$emit("hideGlobalLoader")})}function A(){b.one("person-profile/rest-v2/profile/labor-activity").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.laborActivityResp=b,b&&(a.laborActivity=b.laborActivity),a.isLaborActivitySectionEnabled=!0,a.isLaborActivitySubsExist=!0):103===b.responseInfo.code?a.isLaborActivitySectionEnabled=!1:106===b.responseInfo.code?(a.isLaborActivitySubsExist=!1,a.isLaborActivitySectionEnabled=!1,a.isLaborActivityMenuShow=!0):102===b.responseInfo.code?a.isLaborActivitySectionOff=!0:a.isLaborActivitySectionEnabled=!1,a.$emit("hideGlobalLoader")})}function B(){b.one("person-profile/rest-v2/profile/military-status").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.militaryStatusResp=b,console.log("militaryStatusResponse ",b),b&&(a.militaryStatus=b.militaryStatus),a.isMilitaryStatusSectionEnabled=!0,a.isMilitaryStatusSubsExist=!0):103===b.responseInfo.code?a.isMilitaryStatusSectionEnabled=!1:106===b.responseInfo.code?(a.isMilitaryStatusSubsExist=!1,a.isMilitaryStatusSectionEnabled=!1,a.isMilitaryStatusMenuShow=!0):102===b.responseInfo.code?a.isMilitaryStatusSectionOff=!0:a.isMilitaryStatusSectionEnabled=!1,a.$emit("hideGlobalLoader")})}function C(){b.one("person-profile/rest-v2/profile/pension-savings").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.pensionSavingsResp=b,b&&(a.pensionSavings=b.pensionSavings),a.isPensionSavingsSectionEnabled=!0,a.isPensionSavingsSubsExist=!0):103===b.responseInfo.code?a.isPensionSavingsSectionEnabled=!1:106===b.responseInfo.code?(a.isPensionSavingsSubsExist=!1,a.isPensionSavingsSectionEnabled=!1,a.isPensionSavingsMenuShow=!0):102===b.responseInfo.code?a.isPensionSavingsSectionOff=!0:a.isPensionSavingsSectionEnabled=!1,a.$emit("hideGlobalLoader")})}function D(){b.one("person-profile/rest-v2/profile/gcvp-report601").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.gcvpReport601Resp=b,b&&(a.gcvpReport601=b.gcvpReport601),a.isGcvpReport601SectionEnabled=!0,a.isGcvpReport601SubsExist=!0):103===b.responseInfo.code?a.isGcvpReport601SectionEnabled=!1:106===b.responseInfo.code?(a.isGcvpReport601SubsExist=!1,a.isGcvpReport601SectionEnabled=!1,a.isGcvpReport601MenuShow=!0):102===b.responseInfo.code?a.isGcvpReport601SectionOff=!0:a.isGcvpReport601SectionEnabled=!1,a.$emit("hideGlobalLoader")})}function E(){b.one("person-profile/rest-v2/profile/realties").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.realEstates=b,a.isRealEstateSectionEnabled=!0,a.isRealEstateSubsExist=!0):103===b.responseInfo.code?a.isRealEstateSectionEnabled=!1:106===b.responseInfo.code?(a.isRealEstateSubsExist=!1,a.isRealEstateSectionEnabled=!1,a.isRealEstateMenuShow=!0):102===b.responseInfo.code?a.isRealEstateSectionOff=!0:a.isRealEstateSectionEnabled=!1,a.$emit("hideGlobalLoader")}),F()}function F(){b.one("person-profile/rest-v2/profile/gzk-cad-info").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.cadInfoData=b,G(b),a.isCadInfosSectionEnabled=!0,a.isCadInfosSubsExist=!0):103===b.responseInfo.code?a.isCadInfosSectionEnabled=!1:106===b.responseInfo.code?(a.isCadInfosSubsExist=!1,a.isCadInfosSectionEnabled=!1,a.isCadInfosMenuShow=!0):102===b.responseInfo.code?a.isCadInfosSectionOff=!0:a.isCadInfosEnabled=!1,a.$emit("hideGlobalLoader")})}function G(b){if(b.gzkCadInfo&&b.gzkCadInfo.gzkRegion){var c=[];angular.forEach(b.gzkCadInfo.gzkRegion,function(a){a&&angular.forEach(a,function(a){a&&angular.forEach(a,function(a){a&&angular.forEach(a,function(a){a&&angular.forEach(a,function(a){a&&Object.keys(a).length>2&&c.push(a)})})})})}),a.cadInfos=c}else a.cadInfos=[]}function H(){b.one("person-profile/rest-v2/profile/penalties").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.penalties=b,a.isPenaltySectionEnabled=!0,a.isPenaltySubsExist=!0):103===b.responseInfo.code?a.isPenaltySectionEnabled=!1:106===b.responseInfo.code?(a.isPenaltySubsExist=!1,a.isPenaltySectionEnabled=!1,a.isPenaltyMenuShow=!0):102===b.responseInfo.code?a.isPenaltySectionOff=!0:a.isPenaltySectionEnabled=!1,a.$emit("hideGlobalLoader")})}function I(){b.one("person-profile/rest-v2/profile/social-statuses").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.socialStatuses=b,a.isSocialStatusSectionEnabled=!0,a.isSocialStatusSubsExist=!0):103===b.responseInfo.code?a.isSocialStatusSectionEnabled=!1:106===b.responseInfo.code?(a.isSocialStatusSubsExist=!1,a.isSocialStatusSectionEnabled=!1,a.isSocialStatusMenuShow=!0):102===b.responseInfo.code?a.isSocialStatusSectionOff=!0:a.isSocialStatusSectionEnabled=!1,a.$emit("hideGlobalLoader")})}function J(){var b,c,d,e,f,g,h,i,j=[],k=[],l=[],m=[],n=[],o=[],p=[],q="";for(b=0;b<a.children.children.childList.length;b++)if(a.children.children.childList[b].queueHistories.length){for(f=a.children.children.childList[b].queueHistories,e=0;e<f.length;e++){for(j.push(f[e].preschoolName.ruText),d=0;d<f[e].byYear.length;d++)k.indexOf(f[e].byYear[d].criteria)===-1&&k.push(f[e].byYear[d].criteria);for(i=0;i<f[e].byMonth.length;i++)l.indexOf(f[e].byMonth[i].criteria)===-1&&l.push(f[e].byMonth[i].criteria)}for(k.sort(function(a,b){return a>b?1:a<b?-1:0}),l.sort(function(a,b){return new Date("01/"+a)-new Date("01/"+b)}),c=0;c<f.length;c++){for(o=[],p=[],d=0;d<k.length;d++){for(q="",g=0;g<f[c].byYear.length;g++)f[c].byYear[g].criteria===k[d]&&(q=f[c].byYear[g].position);q||(q=null),o.push(q)}for(m.push(o),i=0;i<l.length;i++){for(q="",h=0;h<f[c].byMonth.length;h++)f[c].byMonth[h].criteria===l[i]&&(q=f[c].byMonth[h].position);q||(q=null),p.push(q)}n.push(p)}a.children.children.childList[b].queueHistories.dataMonth=n,a.children.children.childList[b].queueHistories.dataYear=m,a.children.children.childList[b].queueHistories.datas=m,a.children.children.childList[b].queueHistories.monthName=l,a.children.children.childList[b].queueHistories.yearName=k,a.children.children.childList[b].queueHistories.labels=k,a.children.children.childList[b].queueHistories.series=j,j=[],k=[],l=[],m=[],n=[]}a.byAge=!0,a.byMonth=!1}function K(){b.one("person-profile/rest-v2/profile/children-history").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.children=b,a.isChildrenSectionEnabled=!0,a.isChildrenSubsExist=!0,b.children&&J()):103===b.responseInfo.code?a.isChildrenSectionEnabled=!1:106===b.responseInfo.code?(a.isChildrenSubsExist=!1,a.isChildrenSectionEnabled=!1,a.isChildrenMenuShow=!0):102===b.responseInfo.code?a.isChildrenSectionOff=!0:a.isChildrenSectionEnabled=!1,a.$emit("hideGlobalLoader")})}function L(){b.one("person-profile/rest-v2/profile/preschool-queue-new").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.preschoolQueues=b,a.isPreschoolQueueSectionEnabled=!0,a.isPreschoolQueueSubsExist=!0):103===b.responseInfo.code?a.isPreschoolQueueSectionEnabled=!1:106===b.responseInfo.code?(a.isPreschoolQueueSubsExist=!1,a.isPreschoolQueueSectionEnabled=!1,a.isPreschoolQueueMenuShow=!0):102===b.responseInfo.code?a.isPreschoolQueueSectionOff=!0:a.isPreschoolQueueSectionEnabled=!1,a.$emit("hideGlobalLoader")})}function M(){b.one("person-profile/rest-v2/profile/legal-entity-participants").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.legalEntityParticipantList=b,a.isLEPSectionEnabled=!0,a.isLEPSubsExist=!0):103===b.responseInfo.code?a.isLEPSectionEnabled=!1:106===b.responseInfo.code?(a.isLEPSubsExist=!1,a.isLEPSectionEnabled=!1,a.isLEPMenuShow=!0):102===b.responseInfo.code?a.isLEPSectionOff=!0:a.isLEPSectionEnabled=!1,a.$emit("hideGlobalLoader")})}function N(){b.one("person-profile/rest-v2/profile/marriage").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.marriageResponse=b,a.marriage=b.marriage,a.isMarriageSectionEnabled=!0,a.isMarriageSubsExist=!0):103===b.responseInfo.code?a.isMarriageSectionEnabled=!1:106===b.responseInfo.code?(a.isMarriageSubsExist=!1,a.isMarriageSectionEnabled=!1,a.isMarriageMenuShow=!0):102===b.responseInfo.code?a.isMarriageSectionOff=!0:a.isMarriageSectionEnabled=!1,a.$emit("hideGlobalLoader")})}function O(){b.one("person-profile/rest-v2/profile/gov-interact").get().then(function(b){100===b.code||101===b.code||110===b.responseInfo.code?(a.isGovInteractSectionEnabled=!0,a.isGovInteractSubsExist=!0):103===b.code?a.isGovInteractSectionEnabled=!1:106===b.code?(a.isGovInteractSubsExist=!1,a.isGovInteractSectionEnabled=!1,a.isGovInteractMenuShow=!0):102===b.responseInfo.code?a.isGovInteractSectionOff=!0:a.isGovInteractSectionEnabled=!1,a.$emit("hideGlobalLoader")})}function P(){b.one("person-profile/rest-v2/profile/health-insurance").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.healthInsurance=b,a.isInsuranceSectionEnabled=!0,a.isInsuranceSubsExist=!0):103===b.responseInfo.code?a.isInsuranceSectionEnabled=!1:106===b.responseInfo.code?(a.isInsuranceSubsExist=!1,a.isInsuranceSectionEnabled=!1,a.isInsuranceMenuShow=!0):102===b.responseInfo.code?a.isInsuranceSectionOff=!0:a.isInsuranceSectionEnabled=!1,a.$emit("hideGlobalLoader")})}function Q(){b.one("person-profile/rest-v2/profile/recommender").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.isRecommenderEnabled=!0,a.isRecommenderExist=!0,a.recommenders=b.recommenders,a.recommendersInfo=b.updateInfo):103===b.responseInfo.code?a.isRecommenderEnabled=!1:106===b.responseInfo.code?(a.isRecommenderExist=!1,a.isRecommenderEnabled=!1,a.isRecommenderMenuShow=!0):102===b.responseInfo.code?a.isRecommenderSectionOff=!0:a.isRecommenderEnabled=!1,a.$emit("hideGlobalLoader")})}function R(){var a="recommender",b=getCookie(a);return b}function S(){var b,c,d,e="recommender",f=getCookie(e),g=f.split(","),h=[],i="";if(h=a.messageRecommenders.recommenderList,""===f){for(b=0;b<h.length;b++)i+=b===h.length-1?h[b].code:h[b].code+",",a.msgRecommender.push(h[b]);document.cookie=e+"="+i+"; "}else if("empty"!==f)for(d=0;d<g.length;d++)for(c=0;c<h.length;c++)g[d]===h[c].code&&a.msgRecommender.push(h[c])}function T(a){var b,c="recommender",d=getCookie(c),e=d.split(",");if(1===e.length)return void(document.cookie=c+"=empty; ");for(b=0;b<e.length;b++)e[b]===a&&(e.splice(b,1),document.cookie=c+"="+e.toString()+"; ")}function U(){a.messageEnable=!1,"empty"===R()||a.notifyRecommender?a.msgRecommender=[]:b.one("person-profile/rest-v2/profile/recommender-info").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code?(a.messageEnable=!0,a.messageRecommenders=b.recommenders,a.messageRecommenders&&S()):(a.messageEnable=!1,a.msgRecommender=[])})}function V(b){100===b.responseInfo.code?(null!==b.property.value&&""!==b.property.value&&("true"===b.property.value.toLowerCase()||"yes"===b.property.value.toLowerCase()||"on"===b.property.value.toLowerCase()?a.notifyRecommender=!0:"false"!==b.property.value.toLowerCase()&&"no"!==b.property.value.toLowerCase()&&"off"!==b.property.value.toLowerCase()&&""!==b.property.value.toLowerCase()||(a.notifyRecommender=!1)),U()):101===b.responseInfo.code&&(a.notifyRecommender=!1,U())}function W(){na.get({key:"RECOMMENDER"}).then(V)}function X(){b.one("person-profile/rest-v2/profile/administrative-penalty").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.admPenaltyResponse=b,a.admPenalty=b.administrativePenalties,a.isAdmPenaltySectionEnabled=!0,a.isAdmPenaltySubsExist=!0):103===b.responseInfo.code?a.isAdmPenaltySectionEnabled=!1:106===b.responseInfo.code?(a.isAdmPenaltySubsExist=!1,a.isAdmPenaltySectionEnabled=!1,a.isAdmPenaltyMenuShow=!0):102===b.responseInfo.code?a.isAdmPenaltySectionOff=!0:a.isAdmPenaltySectionEnabled=!1,a.$emit("hideGlobalLoader")})}function Y(){b.one("person-profile/rest-v2/profile/government-employee").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.govEmployeeResponse=b,a.govEmployee=b.govEmployees,a.isGovEmployeeSectionEnabled=!0,a.isGovEmployeeSubsExist=!0):103===b.responseInfo.code?a.isGovEmployeeSectionEnabled=!1:106===b.responseInfo.code?(a.isGovEmployeeSubsExist=!1,a.isGovEmployeeSectionEnabled=!1,a.isGovEmployeeMenuShow=!0):102===b.responseInfo.code?a.isGovEmployeeSectionOff=!0:a.isGovEmployeeSectionEnabled=!1,a.$emit("hideGlobalLoader")})}function Z(c){if(a.preschool.isLoad=!0,c){var d="person-profile/rest-v2/profile/preschool-payment-info?childIin="+c.childIin+"&regionCode="+c.regionCode;b.one(d).get().then(function(b){var d="RU";b.responseInfo&&200===b.responseInfo.code&&b.preschoolPayment?(a.preschool.preschool=b.preschoolPayment,a.preschool.preschool.backUrl=baseUrl,a.preschool.preschool.currency="KZT",a.preschool.preschool.amount=c.amountNew||b.preschoolPayment.amount,g.currentLanguage&&(d=g.currentLanguage.toUpperCase()),a.preschool.preschool.lang="KK"===d?"KZ":"RU",a.preschool.isLoad=!1):aa()},function(){aa()})}}function $(){var c="person-profile/rest-v2/profile/preschool-payment-url";a.preschool.preschool?(a.preschool.isLoad=!0,b.all(c).post(a.preschool.preschool).then(function(a){a.responseInfo&&200===a.responseInfo.code?window.location.replace(a.url):aa()},function(){aa()})):aa()}function aa(){toastr.error(i18n.translate("profile.updateError")),a.preschool.hide(),a.preschool.isLoad=!1}function ba(){b.one("person-profile/rest-v2/profile/transports").get().then(function(b){b&&(100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.autos=b,a.isAutoSectionEnabled=!0,a.isAutoSubsExist=!0):103===b.responseInfo.code?a.isAutoSectionEnabled=!1:106===b.responseInfo.code?(a.isAutoSubsExist=!1,a.isAutoSectionEnabled=!1,a.isAutoMenuShow=!0):102===b.responseInfo.code?a.isAutoSectionOff=!0:a.isAutoSectionEnabled=!1,a.$emit("hideGlobalLoader"))})}function ca(){b.one("person-profile/rest-v2/profile/tech-inspections").get().then(function(b){var c;if(b){if(100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code){if(m(b.transportList),a.techInspections=b,a.isTechInspSectionEnabled=!0,a.isTechInspSubsExist=!0,null!==b.transportList&&b.transportList.length>0)for(c=0;c<b.transportList.length;c++)null!==b.transportList[c].techInspection&&(a.isTechInspectionExist=!0)}else 103===b.responseInfo.code?a.isTechInspSectionEnabled=!1:106===b.responseInfo.code?(a.isTechInspSubsExist=!1,a.isTechInspSectionEnabled=!1,a.isTechInspMenuShow=!0):102===b.responseInfo.code?a.isTechInspSectionOff=!0:a.isTechInspSectionEnabled=!1;a.$emit("hideGlobalLoader")}})}function da(){ka.get().then(function(b){b&&(100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.isMSignEnabled=!0,a.ismSignSubsExist=!0,a.mSign=b):102===b.responseInfo.code?a.ismSignEnabledoff=!0:106===b.responseInfo.code?(a.isMSignMenuShow=!0,a.isMSignEnabled=!1,a.ismSignSubsExist=!1):a.isMSignEnabled=!1,a.$emit("hideGlobalLoader"))})}function ea(a,b,c){for(var d=a.length;d--;)a[d]&&a[d].hasOwnProperty(b)&&arguments.length>2&&a[d][b]===c&&a.splice(d,1);return a}function fa(){b.one("person-profile/rest-v2/profile/").get().then(function(b){a.profile=b.profile,null!==b.profile&&(g.profileDisabled=!1,a.conQueueUrl="https://egov.kz/services/SR.06/",g.isProfileEnabled=b.profile.enabled,"1"===b.profile.genderCode?(a.maleIin=b.profile.iin,a.femaleIin=""):(a.femaleIin=b.profile.iin,a.maleIin="")),a.fetchSubscriptionCount(),E(),M(),N(),I(),v(),x(),ba(),H(),y(),z(),A(),B(),C(),D(),u(),t(),p(),k(),o(),q(),r(),s(),w(),K(),L(),O(),da(),X(),W(),Q(),Y(),P(),ca(),a.UI.getTimeline(),a.$emit("hideGlobalLoader")})}var ga=b.one("nss/rest-v2/settings/mbc-phone"),ha=b.one("nss/rest-v2/settings/contact/mail"),ia=b.all("person-profile/rest-v2/profile/driver-licenses"),ja=b.all("person-profile/rest-v2/profile/transports"),ka=b.one("person-profile/rest-v2/profile/msign"),la=b.all("person-profile/rest-v2/profile/msign-alias"),ma=b.all("person-profile/rest-v2/profile/msign-pin"),na=b.one("nss/rest-v2/settings/property");a.$emit("showGlobalLoader"),a.loading={confirm:!1,main:!1,documents:!1,addresses:!1,driverLicense:!1,realEstates:!1,socialStatus:!1,workPlace:!1,legalEntityParticipants:!1,marriage:!1,children:!1,penaltyDriverLicenses:!1,transports:!1,penalties:!1},a.isSectionPermissionExist=!0,a.isEds=!1,a.showLoadingSign=!1,a.notifyRecommender=!1,a.messageEnable=!1,a.msgRecommender=[],a.registeredPersons=[],a.showRefreshUserCardsList=!0,a.showRegisterUserCard=!0,a.UI={timelineObject:b.one("nss/rest-v2/settings/property"),isSameDay:function(a,b){return a&&b?moment(a).format("D MMMM YYYY")===moment(b).format("D MMMM YYYY"):null},property:{advanced:!1},admPenalty:{advanced:!1},recommend:{advanced:!1},licenses:{advanced:!1,licensesContentFilter:"",licensesSourceFilter:""},phone:{confirmationCode:""},state:{editingContacts:!1,deleteMcdbPhone:!1,editingEmail:!1,confirmingEmail:!1,confirmingPhone:!1,emailRemoved:!1,phoneRemoved:!1,anyDropdownOpen:!1,dropdown:{realty:!1,regAddress:!1,socialStatus:!1,marriage:!1,individualEntrepreneur:!1,retirementSavings:!1,governmentEmployee:!1,administrativePenalty:!1},realtyDropdown:[],cadInfosDropdown:[],childDropdown:[],preschoolQueueDropdown:[]},scrollTo:function(a){var b=angular.element(document.getElementById(a));e.scrollToElement(b,40,250)},timeline:{show:!1},toggleTimeline:function(){this.timeline.show=!this.timeline.show,a.isEds&&this.showTimeline(this.timeline.show)},getTimeline:function(){var b=this;b.timelineObject.get({key:["TIMELINE"]}).then(function(c){null!==c.property&&a.isEds?b.timeline.show="true"===c.property.value:b.timeline.show=!1})},showTimeline:function(b){var c=this;c.timelineObject.put({key:"TIMELINE",value:b}).then(function(){a.UI.getTimeline()})},recommender:{isModalVisible:!1,toggleModal:function(){this.isModalVisible=!this.isModalVisible,this.isModalVisible||(a.serviceList=[])},show:function(c){this.toggleModal(),b.one("person-profile/rest-v2/profile/recommender-detail?code="+c).get().then(function(b){100===b.responseInfo.code&&(a.serviceList=b.recommenders,a.updateMessage(c))})}}},a.date={today:new Date},i.prototype.getPositions=function(){var a,b,c,d,e,f,g;return a=new Date-this.begin,b=this.end-this.begin,c=b/this.length,d=a/c,g=d>0&&d<this.length,g?(e=d.toFixed(2)+"%",f=d>3&&this.length-d>3?"-50%":this.length-d<3?"-75%":d>3?"-50%":"-25%"):e=f=0,{indicator:e,caption:f,isVisible:g}},a.Timeline=i,toastr.options={positionClass:"toast-top-right",timeOut:4e3},a.toggleDropdown=new j(a.UI.state.dropdown),a.toggleCadInfosDropdown=function(b){a.UI.state.cadInfosDropdown[b]=!a.UI.state.cadInfosDropdown[b]||!a.UI.state.cadInfosDropdown[b],angular.forEach(a.UI.state.cadInfosDropdown,function(c,d){d!==b&&(a.UI.state.cadInfosDropdown[d]=!1)})},a.toggleRealtyDropdown=new j(a.UI.state.realtyDropdown),a.toggleChildDropdown=new j(a.UI.state.childDropdown),a.togglePreschoolQueueDropdown=new j(a.UI.state.preschoolQueueDropdown),a.oldMail="",a.toggleEditingContacts=function(){a.isEds?(a.UI.state.editingEmail&&a.cancelEditingEmail(),b.one("nss/rest-v2/settings/mbcCodeWord").get({phoneNumber:"7"+a.mbcPhone.phone}).then(function(b){a.mbcPhone.codeWord=b.codeWord,a.UI.state.editingContacts=!a.UI.state.editingContacts,a.oldPhone=a.mbcPhone.phone,a.oldCodeWord=a.mbcPhone.codeWord,a.UI.phone.confirmationCode=""})):a.DownloadModal.isVisible=!0},a.toggleDeletingMcdbPhone=function(){a.phoneDeleteConfirmation.first.isVisible=!0},a.toggleEditingEmail=function(){a.isEds?(a.UI.state.editingContacts&&a.cancelEditingContacts(),a.UI.state.editingEmail=!0,a.oldMail=a.mail):a.DownloadModal.isVisible=!0},a.cancelEditingEmail=function(){a.UI.state.editingEmail=!1,a.mail=a.oldMail},a.cancelEditingContacts=function(){a.UI.state.editingContacts=!1,a.UI.state.confirmingPhone=!1,a.UI.state.sentPhoneCode=!1,a.UI.phone.confirmationCode="",a.mbcPhone.phone=a.oldPhone,a.mbcPhone.codeWord=a.oldCodeWord},a.removeEmail=function(){ha.remove().then(function(b){b!==!0&&"true"!==b||(a.UI.state.emailRemoved=!0)})},a.mbcPhone={phone:"",codeWord:""},a.sendCode=function(){var c=b.one("nss/rest-v2/settings/mbcSendCode/7"+a.mbcPhone.phone);c.get().then(function(b){110===b.responseInfo.code?toastr.error(i18n.translate("profile.contactSaveError"),i18n.translate("profile.connectionError")):(toastr.success(i18n.translate("phone.smsSentSuccessfully"),i18n.translate("profile.posted")),a.UI.state.confirmingPhone=!0)})},a.lockorUnlockMbc=function(){prepareModals(),a.lockorUnlockAction=!0,a.modals.phoneApplet.visible=!0,a.oldPhone=a.mbcPhone.phone},a.confirmPhoneDirectly=function(){prepareModals(),a.mbcRequest="CONFIRM",a.lockorUnlockAction=!0,a.modals.phoneApplet.visible=!0},a.confirmPhone=function(){prepareModals(),a.UI.phone.confirmationCode&&a.UI.phone.confirmationCode.length>1?(a.loading.confirm=!0,b.one("nss/rest-v2/settings/mbcVerifyCode").get({phone:"7"+a.mbcPhone.phone,code:a.UI.phone.confirmationCode}).then(function(b){4===b.responseCode?toastr.error(i18n.translate("phone.sendAgain"),i18n.translate("phone.wrongCode")+"!"):0===b.responseCode?toastr.error(i18n.translate("phone.wrongCode")+"!"):2===b.responseCode?toastr.error(i18n.translate("phone.validationError")):1===b.responseCode?(toastr.success(i18n.translate("phone.codeConfirmedSuccessfully")),a.UI.state.confirmingPhone=!1,a.modals.phoneApplet.visible=!0,a.lockorUnlockAction=!1):6===b.responseCode&&toastr.error(i18n.translate("phone.sendAgain"),i18n.translate("phone.otpExpired")),a.loading.confirm=!1})):toastr.error("",i18n.translate("phone.wrongCode")+"!")},a.signedXml=function(c){var d=[];b.one("nss/rest-v2/settings/mbcRequest/"+c).get({phone:"7"+a.mbcPhone.phone,otpCode:a.UI.phone.confirmationCode,codeWord:a.mbcPhone.codeWord,systemLocId:getPlaceId()}).then(function(b){a.showLoadingSign=!0,b?(d.push(b),document.getElementById("xmlToSign").value=JSON.stringify(d),doSignRequest("IndividualController")):(a.showLoadingSign=!1,openNcaLayerError())})},a.sendSignedXml=function(){var d=JSON.parse(document.getElementById("signedXml").value);d?b.one("nss/rest-v2/settings/registerOrUpdateMbc").get({signedXml:d[0],requestType:a.requestType}).then(function(b){"Success"===b.result?(toastr.success(i18n.translate("phone.saveSuccess")),c.transitionTo("profile.individualEntity"),k()):(111===b.errorCode?toastr.error(i18n.translate("phone.incorrectConfirmCode")):700===b.errorCode?toastr.error(i18n.translate("phone.incorrectIINBIN")):222===b.errorCode?toastr.error(i18n.translate("phone.incorrectUserIIN")):200===b.errorCode?toastr.error(i18n.translate("phone.phoneNumberExist")):444===b.errorCode||555===b.errorCode?toastr.error(i18n.translate("phone.signError")):800===b.errorCode?toastr.error(i18n.translate("phone.incorrectPhoneNumber")):666===b.errorCode?toastr.error(i18n.translate("phone.ecpOverdue")):667===b.errorCode&&toastr.error(i18n.translate("phone.techError")),a.mbcPhone.phone=a.oldPhone,a.oldPhone=""),a.UI.state.editingContacts=!1,a.modals.phoneApplet.visible=!1,a.showLoadingSign=!1,resetSignModal();
}):toastr.error(i18n.translate("signApplet.error"))},a.fetchSubscriptionCount=function(){b.one("person-profile/rest-v2/profile/subscription-state").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code?(g.allSubscriptionCount=b.allSubscriptionCount,g.subscriptionEnabledCount=b.subscriptionEnabledCount,g.subscriptionDisabledCount=b.subscriptionDisabledCount,g.permissionExist=!0):103===b.responseInfo.code&&(g.permissionExist=!1),a.$emit("hideGlobalLoader")})},a.$on("PP_PROFILE",n),a.phoneChangeConfirmation={first:{isVisible:!1,show:function(){this.isVisible=!0},hide:function(){this.isVisible=!1,a.cancelEditingContacts()},agree:function(){this.isVisible=!1,a.sendCode(),a.UI.state.sentPhoneCode=!0}},second:{hide:function(){a.cancelEditingContacts()}}},a.phoneDeleteConfirmation={first:{isVisible:!1,isLoad:!1,show:function(){this.isVisible=!0},hide:function(){this.isVisible=!1,a.cancelDeletingMcdbPhone()},check:function(){this.isLoad||a.checkDeletingMcdbPhone()}},second:{isVisible:!1,confirm:function(){this.isVisible&&a.deleteMcdbPhone()}},third:{isVisible:!1,registeredPhones:[]}},a.checkDeletingMcdbPhone=function(){a.phoneDeleteConfirmation.first.isLoad=!0,b.one("person-profile/rest-v2/profile/registered-phone-numbers").get().then(function(b){a.phoneDeleteConfirmation.first.isLoad=!1,110===b.responseInfo.code?(a.cancelDeletingMcdbPhone(),toastr.error(i18n.translate("profile.unlockPinError"))):100===b.responseInfo.code&&b.response&&(b.response.hasNumber&&"true"===b.response.hasNumber?(b.response.listnumbers&&b.response.listnumbers.phonenumber&&(a.phoneDeleteConfirmation.third.registeredPhones=b.response.listnumbers.phonenumber),a.phoneDeleteConfirmation.third.isVisible=!0,a.phoneDeleteConfirmation.first.isVisible=!1):(a.phoneDeleteConfirmation.second.isVisible=!0,a.phoneDeleteConfirmation.first.isVisible=!1))})},a.cancelDeletingMcdbPhone=function(){a.phoneDeleteConfirmation.third.isVisible=!1,a.phoneDeleteConfirmation.second.isVisible=!1,a.phoneDeleteConfirmation.first.isVisible=!1,a.phoneDeleteConfirmation.first.isLoad=!1,a.phoneDeleteConfirmation.third.registeredPhones=[],a.UI.state.deleteMcdbPhone=!1},a.deleteMcdbPhone=function(){a.mbcPhone.phone&&b.one("person-profile/rest-v2/profile").post("delete-phone-number",a.mbcPhone.phone).then(function(b){100===b.code?(a.cancelDeletingMcdbPhone(),toastr.success(i18n.translate("profile.saveSuccess"),i18n.translate("profile.saveSuccess")),k()):(a.cancelDeletingMcdbPhone(),toastr.error(i18n.translate("mcdbDelete.deleteError"),b.message?b.message:i18n.translate("profile.unlockPinError")))})},a.addEmail=function(){b.all("nss/rest-v2/settings/contact/mail/"+a.mail).post().then(function(b){100===b.responseInfo.code?(toastr.success(i18n.translate("profile.confirmEmailInfo"),i18n.translate("profile.posted")),a.UI.state.editingEmail=!1):toastr.error(i18n.translate("profile.contactSaveError"),i18n.translate("profile.connectionError"))})},a.updateEmail=function(){b.one("nss/rest-v2/settings/contact/mail/"+a.fullContact.id+"/"+a.mail).post().then(function(b){100===b.responseInfo.code?(toastr.success(i18n.translate("profile.confirmEmailInfo"),i18n.translate("profile.posted")),a.UI.state.editingEmail=!1,o()):toastr.error(i18n.translate("profile.contactSaveError"),i18n.translate("profile.connectionError"))})},a.saveContacts=function(){a.mbcPhone.phone&&a.mbcPhone.phone.length>0&&a.mbcPhone.codeWord&&a.mbcPhone.codeWord.length>0&&(a.oldPhone!==a.mbcPhone.phone||a.oldCodeWord!==a.mbcPhone.codeWord?a.phoneChangeConfirmation.first.show():a.UI.state.editingContacts=!1)},a.saveEmail=function(){var b="",c="";a.oldMail&&(b=a.oldMail.toLowerCase()),a.mail&&(c=a.mail.toLowerCase()),l(a.mail)||(a.mail=a.oldMail,toastr.error(i18n.translate("profile.emailError"))),a.mail&&l(a.mail)&&(b!==c?(a.showEmail=!0,a.fullContact?null===a.fullContact.id?a.addEmail():a.updateEmail():a.addEmail()):(a.oldMail&&(a.mail=a.oldMail),a.UI.state.editingEmail=!1))},a.modalShow=!1,a.toggleModal=function(b,c){a.sectionType=b,a.actionType=c,a.modalShow=!0},a.$on("reload",function(b,c){a.reloadService(c,null)}),a.sendConfirmation=function(a){b.one("nss/rest-v2/settings/contacts/"+a+"/send-confirmation").get().then(function(){})},a.resetStateAddingContact=function(){a.stateAddingContact=!1,a.stateAddingContactSecondStep=!1,a.stateAddingContactFirstStep=!1,a.stateAddingContactThirdStep=!1},a.realtyHeight=!1,a.toggleRealty=function(){event.preventDefault(),a.realtyHeight=!0},a.prepareDynamicData=function(a,b){var c,d=a;for(c=0;c<b.length;c++)d=d.replace("{"+c+"}",b[c]);return d},a.realtyOptions=[{code:"availabilityRealty",href:"//egov.kz/services/P3.061/"},{code:"realtyPayTax",href:"//egov.kz/wps/myportal/p2103"},{code:"correctData",href:"//egov.kz/wps/myportal/Esedo"}],a.realtyItemOptions=[{code:"propertEncumbrance",href:"//egov.kz/services/P3.05/"},{code:"realtyTechPassport",href:"//egov.kz/services/P3.10/#/declaration/0//"},{code:"realtyDuplicateTechPassport",href:"//egov.kz/wps/myportal/P3.11?requestNew={2}&phone={1}&cadastralNumber={0}"}],a.cadInfoItemOptions=[{code:"propertEncumbrance",href:"//egov.kz/services/P3.05/"},{code:"realtyTechPassport",href:"//egov.kz/services/P3.10/#/declaration/0//"},{code:"realtyDuplicateTechPassport",href:"//egov.kz/wps/myportal/P3.11?requestNew={2}&phone={1}&cadastralNumber={0}"}],a.marriageOptions=[{code:"marriageCertificateStatement",href:"//egov.kz/wps/myportal/P2.03"}],a.legalParticipantOptions=[{code:"particiaptionInOtherUL",href:"//egov.kz/services/P30.04/#/?iin={0}"}],a.autoOptions=[{code:"payTax",href:"//egov.kz/services/P1.27/"},{code:"depositProperty",href:"//egov.kz/wps/myportal/P3.14"},{code:"autoRegister",href:"//egov.kz/services/REG01/#/declaration/0//"},{code:"correctData",href:"//egov.kz/wps/myportal/Esedo"}],a.clinicOptions=[{code:"clinicAttachmentService",href:"//egov.kz/services/P7.03/"}],a.vuOptions=[{code:"issueDriverLicense",href:"//egov.kz/services/P40.07/"}],a.retirmentSavingsOptions=[{code:"retirmentSavingsReference",href:"//egov.kz/services/P6.01/"},{code:"retirmentSavingsCopying",href:"//egov.kz/services/P80.01/"}],a.individualEntrepreneurOptions=[{code:"individualEntrepreneurCreate",href:"//egov.kz/wps/myportal/P1.20"}],a.childItemOptions=[{code:"repeatBirthCert",href:"//egov.kz/services/P2.10/"},{code:"getBirthCert",href:"//egov.kz/wps/myportal/P2.04?child={0}&mother={1}&father={2}"}],a.preschoolQueueOptions=[{code:"setChildPreschoolQueue",href:"//egov.kz/wps/myportal/S001"}],a.accommodationQueueOptions=[{code:"queueNumber",href:"//egov.kz/services/P18.POSITION/"},{code:"waitingList",href:"//egov.kz/services/P18.SERVICE/"}],a.govEmployeeOptions=[{code:"govEmployeeEnrollment",href:"//egov.kz/services/P25.03/"},{code:"govEmployeeTest",href:"//egov.kz/services/P25.01/"},{code:"govEmployeeKaztest",href:"http://kazakhtest.kz/kz/apply/"}],a.administrativeOptions=[{code:"administrativeService",href:"//egov.kz/services/P21.01/"}],a.$on("PP_RETIREMENT_SAVINGS",q),a.$on("PP_INDIVIDUAL_ENTREPRENEUR",r),a.getPSHEPUrlForAddUserCards=function(){if(a.mail){a.$emit("showGlobalLoader"),a.showRegisterUserCard=!1,setTimeout(function(){a.showRegisterUserCard=!0},5e3);var c;g.currentLanguage&&(c=g.currentLanguage.toUpperCase()),b.one("person-profile/rest-v2/profile/add-pshep-user-cards"+("KK"===c?"/KZ":"/RU")).get().then(function(b){null!==b.url?window.location.href=b.url:null===b.responseInfo?toastr.error(i18n.translate("userCards.userCardAddResponseError"),i18n.translate("userCards.userCardAddError")):null!==b.responseInfo.message&&toastr.error(i18n.translate("userCards.getCardsErrorCodes."+b.responseInfo.message)),a.$emit("hideGlobalLoader")})}else toastr.error(i18n.translate("userCards.needEmail"))},a.deleteUserCard=function(b){b&&b.cardID?(a.modals.deleteUserCard=!0,a.selectedUserCard=b):(a.modals.deleteUserCard=!1,a.selectedUserCard=null,toastr.error(i18n.translate("userCards."+userCardAddResponse.responseInfo.message)))},a.$on("PP_PROCESSING_KZ",s),a.$on("PP_DOCUMENT",t),a.$on("PP_ADDRESS",u),a.$on("PP_DRIVER_LICENSE",v),a.$on("PP_ACCOMMODATION_QUEUE",w),a.$on("PP_LICENSE",x),a.$on("PP_DEBTOR_REGISTER",y),a.$on("PP_HEALTH_PASSPORT",z),a.$on("PP_LABOR_ACTIVITY",A),a.$on("PP_MILITARY_STATUS",B),a.$on("PP_PENSION_SAVINGS",C),a.$on("PP_GCVP_REPORT601",D),a.showGcvpReport601Modal=function(){a.showGcvpReportModal=!0},a.closeGcvpReport601Modal=function(){a.showGcvpReportModal=!1},a.$on("PP_REALTY",E),a.$on("PP_GZK_CAD_INFO",F),a.$on("PP_TRANSPORT_PENALTY",H),a.$on("PP_SOCIAL_STATUS",I),a.changeData=function(b,c){a.byAge=!a.byAge,a.byMonth=!a.byMonth,"by_month"===c?(a.children.children.childList[b].queueHistories.datas=a.children.children.childList[b].queueHistories.dataMonth,a.children.children.childList[b].queueHistories.labels=a.children.children.childList[b].queueHistories.monthName):(a.children.children.childList[b].queueHistories.datas=a.children.children.childList[b].queueHistories.dataYear,a.children.children.childList[b].queueHistories.labels=a.children.children.childList[b].queueHistories.yearName)},a.$on("PP_CHILDREN",K),a.$on("PP_PRESCHOOL_QUEUE_HISTORY",K),a.$on("PP_PRESCHOOL_QUEUE",L),a.$on("PP_LEGAL_PARTICIPANT",M),a.$on("PP_MARRIAGE",N),a.$on("PP_GOV_INTERACT",O),a.$on("PP_HEALTH_INSURANCE",P),a.$on("PP_RECOMMENDER",Q),a.updateMessage=function(b){a.messageEnable=!1,a.msgRecommender=[],T(b),h(function(){U()},5e3)},a.toggleNotifyRecommender=function(){a.notifyRecommender?na.put({key:"RECOMMENDER",value:"YES"}).then(function(){}):na.put({key:"RECOMMENDER",value:"NO"}).then(function(){})},a.$on("PP_ADMINISTRATIVE_PENALTY",X),a.$on("PP_GOVERNMENT_EMPLOYEE",Y),a.reloadService=function(b,c){c&&(c.target.parentNode.setAttribute("style","pointer-events: none"),setTimeout(function(){c.target.parentNode.setAttribute("style","pointer-events: all")},3e4)),a.$emit("showGlobalLoader"),a.reload(b)},a.reload=function(c){b.one("person-profile/rest-v2/profile/synchronize-section/"+c).get().then(function(){a.fetchSubscriptionCount(),a.$emit("hideGlobalLoader")})},a.removeAccommodationQueue=function(a){b.one("person-profile/rest-v2/profile/accommodation-queue/"+a.id).remove().then(function(a){100===a.code&&w()})},a.removeChildren=function(a){b.one("person-profile/rest-v2/profile/children/"+a.id).remove().then(function(a){100===a.code&&K()})},a.removePreschoolQueue=function(a){b.one("person-profile/rest-v2/profile/preschool-queue/"+a.id).remove().then(function(a){100===a.code&&L()})},a.reloadAll=function(c){c&&(c.target.parentNode.setAttribute("style","pointer-events: none"),setTimeout(function(){c.target.parentNode.setAttribute("style","pointer-events: all")},3e4)),a.$emit("showGlobalLoader"),b.one("person-profile/rest-v2/profile/synchronize-all").get().then(function(){a.$emit("hideGlobalLoader")}).then(function(){})},a.payPenalty=function(c,d){a.$emit("showGlobalLoader"),b.one("person-profile/rest-v2/profile/penaltyPaymentUrl/"+c).get({url:f.location.href,requestNumber:d}).then(function(b){"null"===b.paymentUrl||null===b.paymentUrl?(toastr.error("Ошибка при получение ссылки"),a.$emit("hideGlobalLoader")):(f.open(b.paymentUrl,"_blank"),H(),a.$emit("hideGlobalLoader"))})},a.preschool={isVisible:!1,isLoad:!0,amount:0,preschool:null,agree:function(){$()},show:function(a){a.amountNew&&a.amountNew>0?(this.amount=a.amountNew,Z(a),this.isVisible=!0):toastr.error(i18n.translate("profile.sumForPaymentError"))},hide:function(){this.preschool=null,this.isVisible=!1}},a.payAdmPenalty=function(c){var d="http://egov.kz/services/P21.01/?originalId="+c+"&type=ADM";c?(a.$emit("showGlobalLoader"),b.one("person-profile/rest-v2/profile/administrative-penalty-check/"+c).get().then(function(b){151===b.code?f.open(d,"_blank"):150===b.code?(toastr.info(i18n.translate("admPenaltyPaidYet")),a.reloadService("PP_ADMINISTRATIVE_PENALTY",null)):101===b.code?(toastr.info(i18n.translate("admPenaltyPaid404")),a.reloadService("PP_ADMINISTRATIVE_PENALTY",null)):toastr.error(i18n.translate("profile.updateError")),a.$emit("hideGlobalLoader")})):toastr.error(i18n.translate("profile.updateError"))},a.downloadAdmPenalty=function(a){var b="http://egov.kz/services/P21.01/rest/gp/download-violation/"+a;f.open(b,"_blank")},a.$on("PP_TRANSPORT",ba),a.$on("PP_TECH_INSPECTION",ca),a.$on("fetchMSign",da),a.MSignUI={editing:!1,edit:function(a,b){a&&(this.alias=a,this.nickname=a),angular.element(b.currentTarget).parents(".js_msign-parent").toggleClass("is_editing")},cancel:function(a){this.edit(!1,a)},save:function(a,b){var c=this;this.nickname!==this.alias?this.nickname&&this.nickname.length>2&&this.nickname.length<17?la.post({certificate:a,alias:this.nickname}).then(function(a){100===a.code?(da(),c.edit(!1,b),c.nickname="",toastr.success(i18n.translate("profile.pseudoSaveSuccess"))):138===a.code?toastr.error(i18n.translate("profile.pseudoExist")):148===a.code?toastr.error(i18n.translate("profile.pseudoSymbolsInvalid")):toastr.error(i18n.translate("profile.pseudoSaveFail"))}):toastr.error(i18n.translate("profile.pseudoInvalid")):c.cancel(b)},unlockPin:function(){var a=this;ma.post({certificate:a.modal.body}).then(function(b){100===b.code?toastr.success(i18n.translate("profile.unlockPinSave")):toastr.error(i18n.translate("profile.unlockPinError")),a.modal.toggle()})},modal:{isVisible:!1,toggle:function(){this.isVisible=!this.isVisible},show:function(a){this.body=a,this.toggle()}}},a.fetchServiceByName=function(b){"PP_REALTY"===b?E():"PP_LEGAL_PARTICIPANT"===b?M():"PP_MARRIAGE"===b?N():"PP_SOCIAL_STATUS"===b?I():"PP_DRIVER_LICENSE"===b?v():"PP_TRANSPORT_PENALTY"===b?H():"PP_PROFILE"===b?n():"PP_DEBTOR_REGISTER"===b?y():"PP_HEALTH_PASSPORT"===b?z():"PP_LABOR_ACTIVITY"===b?A():"PP_MILITARY_STATUS"===b?B():"PP_PENSION_SAVINGS"===b?C():"PP_GCVP_REPORT601"===b?D():"PP_LICENSE"===b?x():"PP_ADDRESS"===b?u():"PP_DOCUMENT"===b?t():"PP_TRANSPORT"===b?(ba(),ca()):"PP_RETIREMENT_SAVINGS"===b?q():"PP_INDIVIDUAL_ENTREPRENEUR"===b?r():"PP_PROCESSING_KZ"===b?s():"PP_ACCOMMODATION_QUEUE"===b?w():"PP_CHILDREN"===b||"PP_PRESCHOOL_QUEUE_HISTORY"===b?K():"PP_PRESCHOOL_QUEUE"===b?L():"PP_GOV_INTERACT"===b?O():"PP_MSIGN"===b?da():"PP_ADMINISTRATIVE_PENALTY"===b?X():"PP_RECOMMENDER"===b?Q():"PP_GOVERNMENT_EMPLOYEE"===b?Y():"PP_TECH_INSPECTION"===b?ca():"PP_HEALTH_INSURANCE"===b&&P(),a.fetchSubscriptionCount()},a.$on("fetchServiceByName",function(b,c){a.fetchServiceByName(c)}),a.existingContactTypes=[],a.newContact="",a.contactPlaceholder="",a.selectedContactType="EMAIL",a.enteredEmailContact="",a.autoAddDriverLicense=!0,a.newDriverLicenseNumber="",a.newAutoNumber="",a.newAutoTechNumber="",a.setAutoAddDriverLicense=function(b){a.autoAddDriverLicense=b},a.getDriverLicenses=function(){ia.get("",{ownerType:"SOMEONE"}).then(function(b){a.driverLicenses=b.driverLicenseList,a.loading.penaltyDriverLicenses=!1})},a.addAuto=function(){ja.post({number:a.newAutoNumber,techNumber:a.newAutoTechNumber}).then(function(b){b&&(a.autos.push({number:a.newAutoNumber,techNumber:a.newAutoTechNumber}),a.newAutoNumber="",a.newAutoTechNumber="",a.$emit("reload","PP_TECH_INSPECTION"))})},a.removeAuto=function(c){b.one("person-profile/rest-v2/profile/transports/"+c.id).remove().then(function(b){b&&(ea(a.autos,"id",c.id),a.$emit("reloadTransports"))})},a.$on("reloadDriverLicenses",a.getDriverLicenses),a.$on("reloadTransports",a.getAutos),a.DownloadModal={isVisible:!1,isAgreed:!1,show:function(){this.isVisible=!0,this.isAgreed=!1},hide:function(){this.isVisible=!1,this.isAgreed=!1},agree:function(){return this.isVisible=!1,this.isAgreed=!0,window.location=idpUrl+"?lvl=7&url="+encodeURIComponent(location.href),window.location}},a.modals={addingAuto:!1,phoneApplet:{visible:!1,confirmShow:function(){a.modals.confirmModal.isVisible=!0}},confirmModal:{isVisible:!1,close:function(){a.modals.confirmModal.isVisible=!1},agree:function(){a.modals.confirmModal.isVisible=!1,a.modals.phoneApplet.visible=!1,ncaLayerErrorCloseAll(),document.getElementById("personInfo").style.display="none",a.showLoadingSign=!1,a.mbcPhone.isConfirmed&&a.cancelEditingContacts()}},addingRegion:!1,addChildren:!1,show:{region:function(){a.modals.addingRegion=!0,a.serviceCode="S007"},children:function(){a.modals.addChildren=!0},preschool:function(b){a.modals.addingRegion=!0,a.serviceCode="S001",a.iin=b},auto:function(){a.modals.addingAuto=!0}},userCardsApplet:{visible:!1,confirmShow:function(){a.modals.confirmModal.isVisible=!0}}},a.moreThan7=function(a){var b=864e5,c=new Date,d=new Date(a),e=Math.abs(c-d);return Math.round(e/b)/365>7},a.goToProcessing=function(){window.open(a.urlCards,"_blank")},g.disablePersonProfile=function(){b.one("person-profile/rest-v2/profile/disable-person-profile").get().then(function(){fa()})},g.switchOnLegalPersonProfile=function(){b.one("person-profile/rest-v2/profile/switch-on-person-profile").get().then(function(){fa()})},fa(),a.searchRegisteredPersonsByRealtyId=function(c){a.registeredPersons[c]?a.registeredPersons[c].visible=!a.registeredPersons[c].visible:b.one("person-profile/rest-v2/profile/search-registered-persons/"+c).get().then(function(b){b&&(a.registeredPersons[c]=b),a.$emit("hideGlobalLoader")})},a.getTempAddressText=function(a){var b=new Date(a),c=b.getDate(),d=b.getMonth()+1;c<10&&(c="0"+c),d<10&&(d="0"+d);var e=c+"."+d+"."+b.getFullYear();return i18n.translate("profile.registeredTemp").replace("date",e)},a.hideStreetPrefix=function(a){var b=!1;if(a){var c=a.toLowerCase();c.indexOf("улица")===-1&&c.indexOf("ул ")===-1&&c.indexOf("ул.")===-1&&c.indexOf("проспект")===-1&&c.indexOf("пр ")===-1&&c.indexOf("пр.")===-1&&c.indexOf("мкр")===-1&&c.indexOf("жилой массив")===-1&&c.indexOf("көше")===-1&&c.indexOf("көш.")===-1||(b=!0)}return b}}angular.module("myegovApp").controller("IndividualController",a),a.$inject=["$scope","commonRestangular","$state","$stateParams","$document","$window","$rootScope","$timeout"]}(),function(){function a(a,b){var c=this,d=a.one("nss/rest-v2/settings/contact/confirm/"+b.confirmationCode);c.profileLink=baseUrl,c.confirmed=!1,c.show=!1,d.get().then(function(a){c.show=!0,a&&(c.confirmed=!0)})}angular.module("myegovApp").controller("EmailConfirmationController",a),a.$inject=["commonRestangular","$stateParams"]}(),function(){function a(a,b,c,d,e){function f(){g(),h(),i()}function g(){e.getInboxUnreadCount().then(function(a){H.unreadInboxMessageCount=a.inboxUnreadCount})}function h(){a.queryText=b.params.queryText?b.params.queryText:""}function i(){a.$emit("poolingEvent"),j(),k(),l(),m()}function j(){e.getRequestCategories().then(function(a){H.historyCategories=a.sourceSystemList,n("allUnreadRequestCount",H.historyCategories)})}function k(){e.getNotificationCategories().then(function(a){H.norificationCategories=a.categoryList,n("allUnreadNotificationCount",H.norificationCategories)})}function l(){H.unreadPaymentCount=0,e.getPaymentUnread().then(function(a){a.paymentUnreadCount&&(H.unreadPaymentCount=parseInt(a.paymentUnreadCount,10))})}function m(){H.unreadArchivedCount=0,e.getArchivedunread().then(function(a){a.archiveUnreadCount&&(H.unreadArchivedCount=parseInt(a.archiveUnreadCount,10))})}function n(a,b){var c=0,d=0,e=b;if(H[a]=0,e)for(c=e.length,d=0;d<c;d++)H[a]+=e[d].unreadCount}function o(c,d){var e,f=a.maxPage;d.page||(d.page=1),e=parseInt(d.page,10),e=e<=f?c?e+1:e-1:f,e>0&&e<=f&&b.go(b.current.name,{sourceSystemId:d.sourceSystemId,govAgencyId:d.govAgencyId,page:e,queryText:d.queryText})}function p(a){var b=a.id,d=0;H.navigationObj=a.params,H.previousState=a.state,H.prevMsgDisable=!1,H.nextMsgDisable=!1,_.filter(c.switchInboxList,function(a,c){a.id===b&&(d=c)}),d===c.switchInboxList.length-1&&(H.nextMsgDisable=!0),0===d&&(H.prevMsgDisable=!0),H.currentMsgCount=d+1}function q(a){var d,e,f,g={},h=b.params.requestId||b.params.notificationId||b.params.paymentId||b.params.archivedId,i=parseInt(h,10),j=0;c.switchInboxList&&c.switchInboxList.length>1?(a&&!H.nextMsgDisable||!a&&!H.prevMsgDisable)&&(_.filter(c.switchInboxList,function(a,b){a.id===i&&(j=b)}),e=a?j+1:j-1,f=c.switchInboxList[e],e>=1&&(H.prevMsgDisable=!1),e<=c.switchInboxList.length-1&&(H.nextMsgDisable=!1),f.archived?(d="inbox.archive",g={archivedId:f.id}):"NOTIFICATION"===f.inboxType?(d="inbox.notification",g={notificationId:f.id}):"REQUEST_HISTORY"===f.inboxType?(d="inbox.request",g={requestId:f.id}):"PAYMENT_HISTORY"===f.inboxType&&(d="inbox.payment",g={paymentId:f.id}),e===c.switchInboxList.length-1&&(H.nextMsgDisable=!0),0===e&&(H.prevMsgDisable=!0),H.currentMsgCount=e+1,b.go(d,g)):t()}function r(c){var d,e="inbox.request"===c||"inbox.notification"===c||"inbox.payment"===c||"inbox.archive"===c?"inbox.all":c;a.queryText&&(d={page:1},d.queryText=a.queryText,b.go(e,d))}function s(){b.params.queryText?(b.params.queryText="",b.params.page=1,b.go(b.current.name,b.params)):a.queryText=""}function t(){H.navigationObj?H.previousState?b.go(H.previousState,H.navigationObj):b.go("inbox.all",H.navigationObj):b.go("inbox.all")}function u(){d.scrollTo(0,angular.element(".js_scroll-top").offsetTop)}function v(){var b=H.selectedList.length>1?i18n.translate("messagesTrashedSuccess"):i18n.translate("messageTrashedSuccess");a.$emit("showGlobalLoader"),e.setArchiveList(H.selectedList).then(function(c){100===c.code?(H.selectedList=[],a.$broadcast("updateList"),toastr.success(b)):a.$emit("hideGlobalLoader")})}function w(){var c=parseInt(b.params.notificationId,10);a.$emit("showGlobalLoader"),c&&e.setArchive(c).then(function(b){100===b.code?(toastr.success(i18n.translate("messageTrashedSuccess")),t()):a.$emit("hideGlobalLoader")})}function x(){var c=b.current.name;a.$emit("showGlobalLoader"),c.indexOf("requests")>-1?e.setRequestAsRead(H.selectedList).then(y):c.indexOf("notifications")>-1||c.indexOf("archived")>-1?e.setNotificationAsRead(H.selectedList).then(y):c.indexOf("payments")>-1?e.setPaymentAsRead(H.selectedList).then(y):e.setInboxAsRead(H.selectedList).then(y)}function y(b){100===b.code?(H.selectedList=[],a.$broadcast("updateList"),H.allCheckbox=!1):a.$emit("hideGlobalLoader")}function z(){var b=H.selectedList.length>1?i18n.translate("messagesRestroredSuccess"):i18n.translate("messageRestroredSuccess");a.$emit("showGlobalLoader"),e.setUnarchiveList(H.selectedList).then(function(c){100===c.code?(H.selectedList=[],a.$broadcast("updateList"),toastr.success(b),H.allCheckbox=!1):a.$emit("hideGlobalLoader")})}function A(){var a=parseInt(b.params.archivedId,10);a&&e.setUnarchive(a).then(function(a){100===a.code&&(toastr.success(i18n.translate("messageRestroredSuccess")),t())})}function B(b){a.$broadcast("selectAllCheckbox",{checked:b})}var C,D,E,F,G,H=this;return H.selectedList=[],H.nextMsgDisable=!1,H.prevMsgDisable=!1,H.allCheckbox=!1,H.selectAll=B,H.deleteMessages=v,H.deleteMessage=w,H.markAsReadMessages=x,H.restoreMessage=A,H.restoreMessages=z,H.paginateMsg=q,H.paginate=o,H.goBack=t,H.search=r,H.resetSearch=s,c.profileDisabled?b.go("profile-disabled"):(f(),a.refreshList=function(){a.refresh(),a.$broadcast("updateList")},a.refresh=function(){g(),i(),u()},a.isMainStates=function(a){return!("inbox.all"!==a&&"inbox.requests.all"!==a&&"inbox.requests.source"!==a&&"inbox.notifications.all"!==a&&"inbox.notifications.agency"!==a&&"inbox.payments.all"!==a&&"inbox.archived.all"!==a)},C=a.$on("inboxDataEvent",a.refresh),D=a.$on("updateInboxCounter",function(){H.allCheckbox=!1,H.selectedList=[],i()}),E=a.$on("msgSwitcher",function(a,b){p(b)}),F=a.$on("inboxPagination",function(b,c){H.selectedList=[],a.fromItem=c.fromItem,a.toItem=c.toItem,a.allItemCount=c.allItemCount,a.currentPage=c.currentPage,a.maxPage=c.maxPage}),G=a.$on("selectedList",function(b,c){var d=0;c&&(H.selectedList=c.items,a.itemOnPage=c.maxItem,d=angular.isArray(H.selectedList)?H.selectedList.length:H.selectedList.notification.length+H.selectedList.paymentHistory.length+H.selectedList.requestHistory.length,H.allCheckbox=d===a.itemOnPage)}),void a.$on("$destroy",function(){C(),D(),E(),F(),G()}))}function b(a,b,c,d,e){function f(){e.scrollTo(0,angular.element(".js_scroll-top").offsetTop),a.$emit("showGlobalLoader"),g(),h(),i()}function g(){a.selectedArray={notification:[],requestHistory:[],paymentHistory:[]}}function h(){s.page=b.params.page?parseInt(b.params.page,10):1,s.offset=c.inboxItemLimit,b.params.queryText?(s.queryText=b.params.queryText,a.queryText=b.params.queryText):a.$parent.queryText=""}function i(){d.getInbox(s).then(function(c){var d,e={};100===c.responseInfo.code&&(d=c.inboxContainer,a.inbox=d,s.page>d.maxPage&&b.go(b.current.name,{page:d.maxPage}),s.page<1&&b.go(b.current.name,{page:1}),e.fromItem=d.offset*(d.currentPage-1)+1,e.toItem=d.offset*d.currentPage<d.allItemCount?d.offset*d.currentPage:d.allItemCount,e.currentPage=d.currentPage,e.allItemCount=d.allItemCount,e.maxPage=d.maxPage,a.$emit("inboxPagination",e)),a.$emit("hideGlobalLoader")})}function j(d){c.switchInboxList=a.inbox.inboxList,a.$emit("msgSwitcher",{id:d,params:b.params,state:b.current.name})}function k(a){var b;return"NOTIFICATION"===a?b="notifications":"REQUEST_HISTORY"===a?b="requests":"PAYMENT_HISTORY"===a&&(b="payments"),b}function l(a){j(a),d.goToRequest(a)}function m(a){j(a),d.goToNotification(a)}function n(a){j(a),d.goToPayment(a)}function o(){var b={maxItem:a.inbox.inboxList.length,items:a.selectedArray};a.$emit("selectedList",b)}function p(b,c){c.checked?(a.selectedArray.paymentHistory=_.pluck(_.filter(a.inbox.inboxList,{inboxType:"PAYMENT_HISTORY"}),"id"),a.selectedArray.notification=_.pluck(_.filter(a.inbox.inboxList,{inboxType:"NOTIFICATION"}),"id"),a.selectedArray.requestHistory=_.pluck(_.filter(a.inbox.inboxList,{inboxType:"REQUEST_HISTORY"}),"id")):g(),o()}function q(b,c){var d="notification";"PAYMENT_HISTORY"===c?d="paymentHistory":"REQUEST_HISTORY"===c&&(d="requestHistory"),a.selectedArray[d].indexOf(b)===-1?a.selectedArray[d].push(b):a.selectedArray[d].splice(a.selectedArray[d].indexOf(b),1),o()}function r(){g(),i(),a.$emit("updateInboxCounter")}var s={};return c.switchInboxList=[],a.getInboxType=k,a.goToRequest=l,a.goToNotification=m,a.goToPayment=n,a.selectItem=q,c.profileDisabled?b.go("profile-disabled"):(f(),a.$on("selectAllCheckbox",p),void a.$on("updateList",r))}angular.module("myegovApp").controller("InboxMainController",a).controller("InboxAllController",b),a.$inject=["$scope","$state","$rootScope","$window","OneInboxServices"],b.$inject=["$scope","$state","$rootScope","OneInboxServices","$window"]}(),function(){function a(a,b,c,d,e){function f(){e.scrollTo(0,angular.element(".js_scroll-top").offsetTop),a.$emit("showGlobalLoader"),g(),h()}function g(){n.page=b.params.page?parseInt(b.params.page,10):1,n.offset=c.inboxItemLimit,b.params.queryText?(n.queryText=b.params.queryText,a.queryText=b.params.queryText):a.$parent.$parent.queryText="",b.params.sourceSystemId?n.tableTypes="REQUEST_HISTORY:"+b.params.sourceSystemId:n.tableTypes="REQUEST_HISTORY_ALL"}function h(){d.getInbox(n).then(function(b){var c,d={};100===b.responseInfo.code&&(c=b.inboxContainer,a.inbox=c,d.fromItem=c.offset*(c.currentPage-1)+1,d.toItem=c.offset*c.currentPage<c.allItemCount?c.offset*c.currentPage:c.allItemCount,d.currentPage=c.currentPage,d.allItemCount=c.allItemCount,d.maxPage=c.maxPage,a.$emit("inboxPagination",d),a.$emit("updateInboxCounter")),a.$emit("hideGlobalLoader")})}function i(d){c.switchInboxList=a.inbox.inboxList,a.$emit("msgSwitcher",{id:d,params:b.params,state:b.current.name})}function j(b){a.selectedArray.requestHistory.indexOf(b)===-1?a.selectedArray.requestHistory.push(b):a.selectedArray.requestHistory.splice(a.selectedArray.requestHistory.indexOf(b),1),k()}function k(){var b={maxItem:a.inbox.inboxList.length,items:a.selectedArray.requestHistory};a.$emit("selectedList",b)}function l(b,c){c.checked?a.selectedArray.requestHistory=_.pluck(_.filter(a.inbox.inboxList),"id"):a.selectedArray.requestHistory=[],k()}function m(){a.selectedArray.requestHistory=[],h()}var n={};return c.switchInboxList=[],a.selectedArray={requestHistory:[]},c.profileDisabled?b.go("profile-disabled"):(a.selectItem=j,f(),a.goToRequest=function(b){a.selectedArray.requestHistory=[],k(),i(b),d.goToRequest(b)},a.$on("updateList",m),void a.$on("selectAllCheckbox",l))}function b(a,b,c,d,e,f){function g(){a.$emit("showGlobalLoader"),l.get().then(function(d){var g=d.requestHistory;"125"===d.responseInfo.code&&(a.isDownload=!1),a.request=g,a.warrantshow=g.applicantIinbin===d.responseInfo.iinbin,a.applicantshow=g.warrantIinbin===d.responseInfo.iinbin,a.messageHistoryList=g.messageHistory,a.paymentHistory=g.paymentHistory,a.participantList=g.participants,a.attachmentList=g.attachments,a.messageHistoryList[0].approval=angular.fromJson(g.messageHistory[0].approvalJson),g&&(c.current.data.addToTitle=e("i18negov")(g.serviceName)+" "+g.number+" • ",f.scrollTo(0,angular.element(".js_scroll-top").offsetTop),g.read||b.one("one-inbox/rest-v2/requests-history/"+c.params.requestId).put({read:!0}).then(function(){a.$emit("poolingEvent"),a.$emit("inboxDataEvent")})),a.$emit("hideGlobalLoader")})}function h(){b.all("one-inbox/rest-v2/requests-history/process/send/"+a.request.number+"/"+a.request.processID+"/"+a.request.serviceCode).post({otp:null,confirmTypeCode:"WITHOUT_EDS",actionCode:a.ChooseSignModal.actionCode,phoneInfo:null,signedXmls:null}).then(function(b){"SUCCES"===b.sendResponse.code?toastr.success(i18n.translate(e("i18nEgovHistory")(b.sendResponse.message))):toastr.error(i18n.translate(e("i18nEgovHistory")(b.sendResponse.message))),a.modals.phoneApplet.visible=!1,g()})}function i(){b.all("one-inbox/rest-v2/requests-history/process/send/"+a.request.number+"/"+a.request.processID+"/"+a.request.serviceCode).post({otp:a.generateOtpModal.third.otpCode,confirmTypeCode:"OTP",actionCode:a.ChooseSignModal.actionCode,phoneInfo:null,signedXmls:null}).then(function(b){"SUCCES"===b.sendResponse.code?toastr.success(i18n.translate(e("i18nEgovHistory")(b.sendResponse.message))):toastr.error(i18n.translate(e("i18nEgovHistory")(b.sendResponse.message))),a.modals.phoneApplet.visible=!1,g()})}function j(){b.all("one-inbox/rest-v2/requests-history/process/generate-otp/"+a.request.serviceCode).post().then(function(b){"SUCCESS"===b.message?(toastr.success(i18n.translate("phone.smsSentSuccessfully"),i18n.translate("profile.posted")),a.generateOtpModal.third.isVisible=!0):toastr.error(i18n.translate("profile.contactSaveError"),i18n.translate("profile.connectionError"))})}function k(){b.all("one-inbox/rest-v2/requests-history/process/send/"+a.request.number+"/"+a.request.processID+"/"+a.request.serviceCode).post({otp:null,confirmTypeCode:"mSign",actionCode:a.ChooseSignModal.actionCode,phoneInfo:{phone_number:a.mSign.current.number,certificateSerialNumber:a.mSign.current.sert},signedXmls:null}).then(function(b){"SUCCES"===b.sendResponse.code?toastr.success(i18n.translate(e("i18nEgovHistory")(b.sendResponse.message))):toastr.error(i18n.translate(e("i18nEgovHistory")(b.sendResponse.message))),a.modals.phoneApplet.visible=!1,g()})}var l=b.one("one-inbox/rest-v2/requests-history/"+c.params.requestId);g(),a.goToPayment=function(a){d.goToPayment(a)},a.signedXml=function(){var b,c=a.ChooseSignModal.xml,d=[];if(c){for(b=0;b<c.length;b++)d.push(c[b].xml);document.getElementById("xmlToSign").value=JSON.stringify(d),doSignRequest("RequestController")}else toastr.error(i18n.translate("signApplet.error"))},a.sendSignedXml=function(){var c,d=[],f=JSON.parse(document.getElementById("signedXml").value);for(c=0;c<a.ChooseSignModal.xml.length;c++)d.push({id:a.ChooseSignModal.xml[c].id,signedXml:f[c]});b.all("one-inbox/rest-v2/requests-history/process/send/"+a.request.number+"/"+a.request.processID+"/"+a.request.serviceCode).post({otp:null,confirmTypeCode:"EDS",actionCode:a.ChooseSignModal.actionCode,phoneInfo:null,signedXmls:d}).then(function(b){b.sendResponse&&("SUCCES"===b.sendResponse.code?toastr.success(i18n.translate(e("i18nEgovHistory")(b.sendResponse.message))):toastr.error(i18n.translate(e("i18nEgovHistory")(b.sendResponse.message)))),
a.modals.phoneApplet.visible=!1,resetSignModal(),g()})},a.DownloadModal={isVisible:!1,isAgreed:!1,show:function(){this.isVisible=!0,this.isAgreed=!1},hide:function(){this.isVisible=!1,this.isAgreed=!1},agree:function(){return this.isVisible=!1,this.isAgreed=!0,f.location=idpUrl+"?lvl=7&url="+encodeURIComponent(location.href),f.location}},a.ChooseSignModal={isVisible:!1,confirmTypes:[],xml:"",actionCode:"",confirmTypeCode:"",actionMessage:[],show:function(a,b,c){this.isVisible=!0,this.confirmTypes=a,this.xml=b,this.actionCode=c},hide:function(){this.isVisible=!1},agree:function(b,c){this.isVisible=!1,this.confirmTypeCode=b,this.actionMessage=c,"EDS"===b?(prepareModals(),a.modals.phoneApplet.visible=!0):"WITHOUT_EDS"===b?a.ConfirmModal.isVisible=!0:"OTP"===b?a.generateOtpModal.first.isVisible=!0:"mSign"===b&&a.mSign.show()}},a.ConfirmModal={isVisible:!1,show:function(){this.isVisible=!0},hide:function(){this.isVisible=!1},agree:function(){this.isVisible=!1,h()}},a.generateOtpModal={first:{isVisible:!1,show:function(){this.isVisible=!0},hide:function(){this.isVisible=!1},agree:function(){this.isVisible=!1,j()}},third:{otpCode:"",isVisible:!1,show:function(){this.isVisible=!0},hide:function(){this.isVisible=!1},confirm:function(){i(),this.isVisible=!1},resend:function(){j()}}},a.modals={phoneApplet:{visible:!1,confirmShow:function(){a.modals.confirmModal.isVisible=!0}},confirmModal:{isVisible:!1,close:function(){a.modals.confirmModal.isVisible=!1},agree:function(){a.modals.confirmModal.isVisible=!1,a.modals.phoneApplet.visible=!1,ncaLayerErrorCloseAll(),document.getElementById("personInfo").style.display="none"}}},a.getNumber=function(b){b?(a.mSign.serts=b.certificate_data,a.mSign.current.number=b.phone_number):toastr.error(i18n.translate("signApplet.getNumber"))},a.getSert=function(b){b?a.mSign.current.sert=b.certificateSerialNumberStr:toastr.error(i18n.translate("signApplet.getSert"))},a.mSign={isVisible:!1,phones:[],serts:[],current:{number:"",sert:0},toggle:function(){this.isVisible=!this.isVisible,this.isVisible||(this.current.number="",this.current.sert=0,a.parentModel=null,a.sertModel=null)},show:function(){this.toggle(),b.one("one-inbox/rest-v2/requests-history/process/user-phones/ApprovalSubprocessTest").get().then(function(b){100===b.responseInfo.code?b.mSignInfo.phones.length&&(a.mSign.phones=b.mSignInfo.phones):toastr.error(i18n.translate("signApplet.error"))})},send:function(){a.mSign.current.number?a.mSign.current.sert?(k(),this.toggle()):toastr.error(i18n.translate("signApplet.getSert")):toastr.error(i18n.translate("signApplet.getNumber"))}}}angular.module("myegovApp").controller("InboxRequestsController",a).controller("RequestController",b),a.$inject=["$scope","$state","$rootScope","OneInboxServices","$window"],b.$inject=["$scope","commonRestangular","$state","OneInboxServices","$filter","$window"]}(),function(){function a(a,b,c,d,e){function f(){e.scrollTo(0,angular.element(".js_scroll-top").offsetTop),a.$emit("showGlobalLoader"),g(),h()}function g(){o.page=b.params.page?parseInt(b.params.page,10):1,o.offset=c.inboxItemLimit,b.params.queryText?(o.queryText=b.params.queryText,a.queryText=b.params.queryText):a.$parent.$parent.queryText="",b.params.govAgencyId?o.tableTypes="NOTIFICATION:"+b.params.govAgencyId:o.tableTypes="NOTIFICATION_ALL"}function h(){d.getInbox(o).then(function(c){var d,e={};100===c.responseInfo.code&&(d=c.inboxContainer,a.inbox=d,e.fromItem=d.offset*(d.currentPage-1)+1,e.toItem=d.offset*d.currentPage<d.allItemCount?d.offset*d.currentPage:d.allItemCount,e.currentPage=d.currentPage,e.allItemCount=d.allItemCount,e.maxPage=d.maxPage,o.page>d.maxPage?(o.page=d.maxPage,b.go(b.current.name,o)):(a.$emit("inboxPagination",e),a.$emit("updateInboxCounter"))),a.$emit("hideGlobalLoader")})}function i(d){c.switchInboxList=a.inbox.inboxList,a.$emit("msgSwitcher",{id:d,params:b.params,state:b.current.name})}function j(b){a.selectedArray.notification.indexOf(b)===-1?a.selectedArray.notification.push(b):a.selectedArray.notification.splice(a.selectedArray.notification.indexOf(b),1),k()}function k(){var b={maxItem:a.inbox.inboxList.length,items:a.selectedArray.notification};a.$emit("selectedList",b)}function l(b,c){c.checked?a.selectedArray.notification=_.pluck(_.filter(a.inbox.inboxList),"id"):a.selectedArray.notification=[],k()}function m(){a.selectedArray.notification=[],h()}function n(a){return!("inbox.notifications.all"!==a&&"inbox.notifications.agency"!==a)}var o={};return c.switchInboxList=[],a.selectedArray={notification:[]},c.profileDisabled?b.go("profile-disabled"):(a.selectItem=j,a.isNotification=n,f(),a.goToNotification=function(b){a.selectedArray.notification=[],k(),i(b),d.goToNotification(b)},a.$on("updateList",m),void a.$on("selectAllCheckbox",l))}function b(a,b,c,d,e){var f=b.one("one-inbox/rest-v2/notification/"+c.params.notificationId);a.$emit("showGlobalLoader"),f.get().then(function(f){var g=f.notification;a.notification=g,g&&(c.current.data.addToTitle=d("i18negov")(g.title)+" • ",e.scrollTo(0,angular.element(".js_scroll-top").offsetTop),a.$emit("hideGlobalLoader"),g.read||b.one("one-inbox/rest-v2/notification/"+c.params.notificationId).put({read:!0}).then(function(){a.$emit("poolingEvent"),a.$emit("inboxDataEvent")}))})}angular.module("myegovApp").controller("InboxNotificationsController",a).controller("NotificationController",b),a.$inject=["$scope","$state","$rootScope","OneInboxServices","$window"],b.$inject=["$scope","commonRestangular","$state","$filter","$window"]}(),function(){function a(a,b,c,d,e){function f(){e.scrollTo(0,angular.element(".js_scroll-top").offsetTop),a.$emit("showGlobalLoader"),g(),h()}function g(){n.page=b.params.page?parseInt(b.params.page,10):1,n.offset=c.inboxItemLimit,n.tableTypes="PAYMENT_HISTORY",b.params.queryText?(n.queryText=b.params.queryText,a.queryText=b.params.queryText):a.$parent.$parent.queryText=""}function h(){d.getInbox(n).then(function(b){var c,d={};100===b.responseInfo.code&&(c=b.inboxContainer,a.inbox=c,d.fromItem=c.offset*(c.currentPage-1)+1,d.toItem=c.offset*c.currentPage<c.allItemCount?c.offset*c.currentPage:c.allItemCount,d.currentPage=c.currentPage,d.allItemCount=c.allItemCount,d.maxPage=c.maxPage,a.$emit("inboxPagination",d),a.$emit("updateInboxCounter")),a.$emit("hideGlobalLoader")})}function i(d){c.switchInboxList=a.inbox.inboxList,a.$emit("msgSwitcher",{id:d,params:b.params,state:b.current.name})}function j(b){a.selectedArray.paymentHistory.indexOf(b)===-1?a.selectedArray.paymentHistory.push(b):a.selectedArray.paymentHistory.splice(a.selectedArray.paymentHistory.indexOf(b),1),k()}function k(){var b={maxItem:a.inbox.inboxList.length,items:a.selectedArray.paymentHistory};a.$emit("selectedList",b)}function l(b,c){c.checked?a.selectedArray.paymentHistory=_.pluck(_.filter(a.inbox.inboxList),"id"):a.selectedArray.paymentHistory=[],k()}function m(){a.selectedArray.paymentHistory=[],h()}var n={};return c.switchInboxList=[],a.selectedArray={paymentHistory:[]},c.profileDisabled?b.go("profile-disabled"):(a.selectItem=j,f(),a.goToPayment=function(b){a.selectedArray.paymentHistory=[],k(),i(b),d.goToPayment(b)},a.$on("updateList",m),void a.$on("selectAllCheckbox",l))}function b(a,b,c,d){var e=b.one("one-inbox/rest-v2/payment-history/"+c.params.paymentId);e.get().then(function(e){var f,g=e.paymentHistory;a.payment=g,a.paymentMessageHistoryList=g.paymentMessageHistoryList,a.paymentDocumentList=g.paymentDocumentList,d.scrollTo(0,angular.element(".js_scroll-top").offsetTop),g.read||b.one("one-inbox/rest-v2/payment-history/"+c.params.paymentId).put({read:!0}).then(function(){a.$emit("poolingEvent"),a.$emit("inboxDataEvent")}),g.price&&g.currency?(f=" ("+g.price+" "+g.currency+")",c.current.data.addToTitle=g.orderNumber+f+" • "):c.current.data.addToTitle=g.orderNumber+" • "})}angular.module("myegovApp").controller("InboxPaymentAllController",a).controller("PaymentController",b),a.$inject=["$scope","$state","$rootScope","OneInboxServices","$window"],b.$inject=["$scope","commonRestangular","$state","$window"]}(),function(){function a(a,b,c,d,e){function f(){a.$emit("showGlobalLoader"),e.scrollTo(0,angular.element(".js_scroll-top").offsetTop),g(),h()}function g(){o.archived=!0,o.page=b.params.page?parseInt(b.params.page,10):1,o.offset=c.inboxItemLimit,b.params.queryText?(o.queryText=b.params.queryText,a.queryText=b.params.queryText):a.$parent.$parent.queryText=""}function h(){d.getInbox(o).then(function(c){var d,e={};100===c.responseInfo.code&&(d=c.inboxContainer,a.inbox=d,e.fromItem=d.offset*(d.currentPage-1)+1,e.toItem=d.offset*d.currentPage<d.allItemCount?d.offset*d.currentPage:d.allItemCount,e.currentPage=d.currentPage,e.allItemCount=d.allItemCount,e.maxPage=d.maxPage,o.page>d.maxPage?(o.page=d.maxPage,b.go(b.current.name,o)):(a.$emit("inboxPagination",e),a.$emit("updateInboxCounter"))),a.$emit("hideGlobalLoader")})}function i(d){c.switchInboxList=a.inbox.inboxList,a.$emit("msgSwitcher",{id:d,params:b.params,state:b.current.name})}function j(b){a.selectedArray.notification.indexOf(b)===-1?a.selectedArray.notification.push(b):a.selectedArray.notification.splice(a.selectedArray.notification.indexOf(b),1),k()}function k(){var b={maxItem:a.inbox.inboxList.length,items:a.selectedArray.notification};a.$emit("selectedList",b)}function l(b,c){c.checked?a.selectedArray.notification=_.pluck(_.filter(a.inbox.inboxList),"id"):a.selectedArray.notification=[],k()}function m(){a.selectedArray.notification=[],h()}function n(a){return!("inbox.archived.all"!==a)}var o={};return a.selectedArray={notification:[]},a.isNotification=n,a.selectItem=j,c.profileDisabled?b.go("profile-disabled"):(f(),a.goToNotification=function(b){a.selectedArray=[],k(),i(b),d.goToArchivedNotification(b)},a.$on("updateList",m),void a.$on("selectAllCheckbox",l))}function b(a,b,c,d,e){var f=b.one("one-inbox/rest-v2/notification/"+c.params.archivedId);a.$emit("showGlobalLoader"),f.get().then(function(f){var g=f.notification;a.notification=g,g&&(c.current.data.addToTitle=d("i18negov")(g.title)+" • ",e.scrollTo(0,angular.element(".js_scroll-top").offsetTop),a.$emit("hideGlobalLoader"),g.read||b.one("one-inbox/rest-v2/notification/"+c.params.archivedId).put({read:!0}).then(function(){a.$emit("poolingEvent"),a.$emit("inboxDataEvent")}))})}angular.module("myegovApp").controller("InboxArchivedAllController",a).controller("ArchivedController",b),a.$inject=["$scope","$state","$rootScope","OneInboxServices","$window"],b.$inject=["$scope","commonRestangular","$state","$filter","$window"]}(),function(){function a(a,b){function c(a){var c={requestId:a};b.transitionTo("inbox.request",c)}function d(a){var c={notificationId:a};b.transitionTo("inbox.notification",c)}function e(a){var c={paymentId:a};b.transitionTo("inbox.payment",c)}function f(a){var c={archivedId:a};b.transitionTo("inbox.archive",c)}function g(){return w.get()}function h(){return y.get()}function i(){return x.get()}function j(){return z.get()}function k(){return A.get()}function l(a){return u.one("notification",a).put({archive:!0})}function m(a){return u.one("notification",a).put({archive:!1})}function n(a){return B.customPUT({idList:a})}function o(a){return C.customPUT({idList:a})}function p(a){return G.customPUT(a)}function q(a){return F.customPUT({idList:a})}function r(a){return D.customPUT({idList:a})}function s(a){return E.customPUT({idList:a})}function t(a){return v.get(a)}var u=a.one("one-inbox/rest-v2/"),v=a.one("one-inbox/rest-v2/search/inbox"),w=a.one("one-inbox/rest-v2/search/unread-count"),x=a.one("one-inbox/rest-v2/search/categories"),y=a.one("one-inbox/rest-v2/search/source-systems"),z=a.one("one-inbox/rest-v2/search/payment-history-unread-count"),A=a.one("one-inbox/rest-v2/search/archive-unread-count"),B=a.all("one-inbox/rest-v2/notification/archive"),C=a.one("one-inbox/rest-v2/notification/unarchive"),D=a.one("one-inbox/rest-v2/notification/read"),E=a.one("one-inbox/rest-v2/payment-history/read"),F=a.one("one-inbox/rest-v2/requests-history/read"),G=a.one("one-inbox/rest-v2/search/read"),H={goToRequest:c,goToNotification:d,goToPayment:e,goToArchivedNotification:f,getInboxUnreadCount:g,getRequestCategories:h,getNotificationCategories:i,getPaymentUnread:j,getArchivedunread:k,setArchive:l,setUnarchive:m,setArchiveList:n,setUnarchiveList:o,setRequestAsRead:q,setInboxAsRead:p,setPaymentAsRead:s,setNotificationAsRead:r,getInbox:t};return H}angular.module("myegovApp").factory("OneInboxServices",a),a.$inject=["commonRestangular","$state"]}(),function(){function a(a,b,c,d){function e(b){100===b.responseInfo.code&&null!==b.property.value&&""!==b.property.value&&("true"===b.property.value.toLowerCase()||"yes"===b.property.value.toLowerCase()||"on"===b.property.value.toLowerCase()?a.notificationDoNotDisturb=!0:"false"!==b.property.value.toLowerCase()&&"no"!==b.property.value.toLowerCase()&&"off"!==b.property.value.toLowerCase()||(a.notificationDoNotDisturb=!1))}function f(b){100===b.responseInfo.code&&null!==b.property.value&&""!==b.property.value&&("true"===b.property.value.toLowerCase()||"yes"===b.property.value.toLowerCase()||"on"===b.property.value.toLowerCase()?a.allowarmconservice=!1:"false"!==b.property.value.toLowerCase()&&"no"!==b.property.value.toLowerCase()&&"off"!==b.property.value.toLowerCase()||(a.allowarmconservice=!0))}function g(b){100===b.responseInfo.code?c.inboxItemLimit=parseInt(b.property.value,10):c.inboxItemLimit=20,a.inboxItemLimit=c.inboxItemLimit}function h(b){100===b.responseInfo.code&&null!==b.property.value&&""!==b.property.value&&("true"===b.property.value.toLowerCase()||"yes"===b.property.value.toLowerCase()||"on"===b.property.value.toLowerCase()?a.notifyRecommender=!0:"false"!==b.property.value.toLowerCase()&&"no"!==b.property.value.toLowerCase()&&"off"!==b.property.value.toLowerCase()||(a.notifyRecommender=!1))}function i(){m.get().then(function(b){null!==b&&""!==b&&100===b.responseInfo.code&&(a.email=b.contact.value,a.oldEmail=b.contact.value)})}function j(b){b&&""!==b&&isNaN(b.property.value)?c.languageItem=b.property.value:c.languageItem=a.languageArray[1]}function k(){a.notificationType&&s.get({notification:a.notificationType.code}).then(function(b){100===b.responseInfo.code||101===b.responseInfo.code?a.notificationTypeModel=!!b.subscriptionList.length:toastr.error(i18n.translate("profile.error110"))})}function l(){r.get().then(function(b){100===b.responseInfo.code?(a.notificationType=b.notificationType,k()):101===b.responseInfo.code?a.notificationType=[]:toastr.error(i18n.translate("profile.error110"))})}var m=b.one("nss/rest-v2/settings/contact/mail"),n=b.one("nss/rest-v2/settings/property"),o=b.one("nss/rest-v2/settings/property"),p=b.one("nss/rest-v2/subscription/is-sms-channel-enabled"),q=b.one("nss/rest-v2/settings/agreement"),r=b.one("nss/rest-v2/subscription/notification/BCT_SMS_POLL"),s=b.one("nss/rest-v2/subscription/subscribes"),t=b.one("nss/rest-v2/subscription/subscribe"),u=b.one("nss/rest-v2/subscription/unsubscribe"),v=b.one("person-profile/rest-v2/profile/lvl");return a.$emit("checkUser"),a.subscriptions=null,a.notificationCost=0,a.sentMessageCount=0,a.limitMessageCount=0,a.smsChannel=!1,a.someVal=!1,a.notificationDoNotDisturb=!1,a.allowarmconservice=!1,a.notifyRecommender=!1,a.isEds=!1,a.inboxItemLimitArray=[20,50,70,100],a.languageArray=[{code:"kk",name:"Казахский"},{code:"ru",name:"Русский"}],a.inboxItemLimit=c.inboxItemLimit,a.agreementShow=!1,c.profileDisabled?d.transitionTo("profile-disabled"):(a.update=function(){a.isSmsChannel()},a.isSmsChannel=function(){p.get().then(function(b){a.smsChannel=100===b.code})},a.toggleNotificationDoNotDisturb=function(){a.notificationDoNotDisturb?o.put({key:"NOTIFICATION_DO_NOT_DISTURB",value:"YES"}).then(e):o.put({key:"NOTIFICATION_DO_NOT_DISTURB",value:"NO"}).then(e)},a.toggleNotifyRecommender=function(){a.notifyRecommender?o.put({key:"RECOMMENDER",value:"YES"}).then(function(){}):o.put({key:"RECOMMENDER",value:"NO"}).then(function(){})},a.changeInboxItemLimit=function(){a.notificationDoNotDisturb?o.put({key:"INBOX_ITEM_LIMIT",value:a.inboxItemLimit}).then(g):o.put({key:"INBOX_ITEM_LIMIT",value:a.inboxItemLimit}).then(g)},a.state={email:"",editing:!1,toggleEditing:function(){a.isEds?(a.email=a.oldEmail,this.editing=!this.editing):this.showEdsModal()},saveEmail:function(c){var d="",e="";a.oldEmail&&(d=a.oldEmail.toLowerCase()),a.email&&(e=a.email.toLowerCase()),d!==e?(b.all("nss/rest-v2/settings/contact/mail/"+c).post().then(function(a){100===a.responseInfo.code?toastr.success(i18n.translate("profile.confirmEmailInfo"),i18n.translate("profile.posted")):114===a.responseInfo.code?toastr.error(i18n.translate("profile.emailError")):toastr.error(i18n.translate("profile.contactSaveError"),i18n.translate("profile.connectionError"))}),this.toggleEditing(),i()):this.toggleEditing()},isEdsVisible:!1,showEdsModal:function(){this.isEdsVisible=!0}},a.modals={edsSignApplet:{visible:!1,confirmShow:function(){a.modals.confirmModal.isVisible=!0}},confirmModal:{isVisible:!1,close:function(){a.modals.confirmModal.isVisible=!1},agree:function(){a.modals.confirmModal.isVisible=!1,a.modals.edsSignApplet.visible=!1,ncaLayerErrorCloseAll(),document.getElementById("personInfo").style.display="none",a.showLoadingSign=!1}}},a.fetchPropertyArmCon=function(){n.get({key:"ALLOW_ARM_CON_SERVICE"}).then(f)},a.cancelEditPropertyArmCon=function(){a.allowarmconservice_before!==a.allowarmconservice&&(a.allowarmconservice=a.allowarmconservice_before)},a.fetchData=function(){n.get({key:"NOTIFICATION_DO_NOT_DISTURB"}).then(e),n.get({key:"INBOX_ITEM_LIMIT"}).then(g),n.get({key:"ALLOW_ARM_CON_SERVICE"}).then(f),i(),q.get().then(function(b){100===b.responseInfo.code&&(a.agreement=b.agreement,a.agreementText=b.agreement.agreement,a.agreementShow=!0)}),v.get().then(function(b){b.requiredLvl&&(a.isEds=Number(b.requiredLvl)>=6)}),o.get({key:"RECOMMENDER"}).then(h),a.isSmsChannel()},a.showAgreementModal=function(){a.agreement?(a.agreementModal.isVisible=!0,c.isOverflow=!0):toastr.error(i18n.translate("agreement.showError"))},a.agreementModal={isVisible:!1,hide:function(){this.isVisible=!1,c.isOverflow=!1}},a.fetchData(),b.one("nss/rest-v2/settings/property").get({key:"NOTIFICATION_LANGUAGE"}).then(function(b){b&&100===b.responseInfo.code&&"kk"===b.property.value?c.languageItem=a.languageArray[0]:c.languageItem=a.languageArray[1]}),a.changeNotificationLanguage=function(){o.put({key:"NOTIFICATION_LANGUAGE",value:a.languageItem.code}).then(j)},a.settingModal={isVisible:!1,checkSubs:function(){a.notificationTypeModel?this.toggle():a.toggleNotificationType()},hide:function(){this.toggle(),a.notificationTypeModel=!1},toggle:function(){this.isVisible=!this.isVisible},agree:function(){this.toggle(),a.toggleNotificationType()}},a.toggleNotificationType=function(){var b=a.notificationTypeModel?t:u,c={channelId:a.notificationType.channels[0].id,notificationTypeId:a.notificationType.id};b.put(c).then(function(a){100!==a.code&&toastr.error(i18n.translate("profile.error110"))})},l(),a.allowarmconservice_before=null,a.toogleArmConSetting=function(){a.requestType="UPDATE",a.allowarmconservice_before=!a.allowarmconservice,a.modals.edsSignApplet.visible=!0},a.signedXml=function(c){var d=[],e={};e=a.allowarmconservice?{key:"ALLOW_ARM_CON_SERVICE",value:"NO"}:{key:"ALLOW_ARM_CON_SERVICE",value:"YES"},b.one("nss/rest-v2/settings/updateArmConAllowRequest/"+c).get(e).then(function(b){a.showLoadingSign=!0,b?(d.push(b),document.getElementById("xmlToSign").value=JSON.stringify(d),doSignRequest("SettingsController")):(a.showLoadingSign=!1,openNcaLayerError())})},void(a.sendSignedXml=function(){var c=JSON.parse(document.getElementById("signedXml").value);c?b.one("nss/rest-v2/settings/updateArmConAllow").get({signedXml:c[0],requestType:a.requestType}).then(function(b){100===b.responseInfo.code?toastr.success(i18n.translate("settings.saveSuccess")):(110===b.responseInfo.code&&toastr.error(i18n.translate("settings.saveError")),a.fetchData()),a.modals.edsSignApplet.visible=!1,a.showLoadingSign=!1}):toastr.error(i18n.translate("signApplet.error"))}))}angular.module("myegovApp").controller("SettingsController",a),a.$inject=["$scope","commonRestangular","$rootScope","$state"]}(),function(){function a(a,b,c,d,e){var f=b.one("nss/rest-v2/billing/billing-history"),g={},h=new Date;return g.page=1,g.start=h.setMonth(h.getMonth()-1),g.end=(new Date).getTime(),g.type="ALL",a.history=null,a.currentPage=1,a.maxPage=0,a.typeArray=["ALL","OTP_AUTH","NOTIFICATION","MO_MT"],a.startDate=g.start,a.endDate=g.end,a.type=g.type,d.page&&(g.page=d.page,a.currentPage=d.page),d.start&&(g.start=parseInt(d.start,10),a.startDate=parseInt(d.start,10)),d.end&&(g.end=parseInt(d.end,10),a.endDate=parseInt(d.end,10)),d.type&&(g.type=d.type,a.type=d.type),e.profileDisabled?c.transitionTo("profile-disabled"):(a.fetchHistory=function(){a.$emit("showGlobalLoader"),f.get(g).then(function(b){a.history=b.billingHistory,a.maxPage=Math.ceil(b.billingHistory.totalRecordCount/20),a.fromItem=20*(a.currentPage-1)+1,a.toItem=20*a.currentPage<b.billingHistory.totalRecordCount?20*a.currentPage:b.billingHistory.totalRecordCount,a.$emit("hideGlobalLoader")})},a.fetchHistory(),a.showHistory=function(b){a.type=b||"ALL",c.transitionTo(c.current.name,{page:a.currentPage,start:a.startDate,end:a.endDate,type:a.type})},void(a.paginate=function(b,d){var e=parseInt(d.page,10);d.page||(d.page=1),e=e<=a.maxPage?b?e+1:e-1:a.maxPage,e>0&&e<=a.maxPage&&c.transitionTo(c.current.name,{page:e})}))}angular.module("myegovApp").controller("HistoryController",a),a.$inject=["$scope","commonRestangular","$state","$stateParams","$rootScope"]}(),function(){function a(a,b,c,d,e){function f(){return e.location=idpUrl+"?lvl=7&url="+encodeURIComponent(location.href),e.location}function g(a){var b=1,d=o.myDocuments.maxPage,e=c.params.page?parseInt(c.params.page,10):b;b=e<=d?a?e+1:e-1:d,b>0&&b<=d&&c.go(c.current.name,{page:b},{reload:!1,notify:!1}).then(function(){l()})}function h(a,b){a&&b&&(p={documentId:a,version:b},o.agreement.toggle())}function i(){b.deleteDocument(p).then(function(){l(),o.agreement.toggle(),p={}})}function j(a){a.myDocuments?100===a.responseInfo.code?(o.loader="finish",o.myDocuments=a.myDocuments):o.loader="error":(o.loader="error",o.myDocuments=[])}function k(){b.getDocuments(q).then(j)}function l(){o.updateStorage=!o.updateStorage,o.loader="loading",q=c.params,k()}function m(){d.profileDisabled&&c.go("profile-disabled"),d.myDocsPermission?k():o.loader="error"}function n(a){b.getCheckUser().then(function(b){"IIN"!==b&&"BIN"!==b||e.open(a,"_parent")})}var o=this,p={},q={};q=c.params,q.page=c.params.page?c.params.page:1,o.page=q.page,o.loader="loading",o.loginEds=f,o.deleteDoc=i,o.showDelModal=h,o.updateList=l,o.navigatePage=g,o.updateStorage=!1,o.download=n,m(),o.agreement={isVisible:!1,toggle:function(){o.agreement.isVisible=!o.agreement.isVisible}}}angular.module("myegovApp").controller("MyDocumentsController",a),a.$inject=["$scope","MydocService","$state","$rootScope","$window"]}();var ssopinger={interval:6e5,init:function(){var a=getCookie("lttping");if(""===a)setTimeout($.proxy(this.getData,this),0);else{var b=(new Date).getTime()-a,c=this.interval;c=b<=this.interval?this.interval-b:0,setTimeout($.proxy(this.getData,this),c)}},getData:function(){var a=this;$.ajax(window.location.protocol+"//idp.egov.kz/idp/keepalive",{type:"GET",contentType:"text/plain; charset=utf-8",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(b){if(setCookie("lttping",(new Date).getTime()),"true"===b)a.timeout();else if("false"===b)return window.location=idpUrl+"?lvl=2&url="+encodeURIComponent(location.href),window.location},error:function(){setCookie("lttping",(new Date).getTime()),a.timeout()}})},timeout:function(){setTimeout($.proxy(this.getData,this),this.interval)}};ssopinger.init(),angular.module("myegovApp").directive("modalAuto",function(){return{restrict:"E",scope:{show:"=",update:"&"},replace:!0,controller:["$scope","commonRestangular",function(a,b){var c=b.all("person-profile/rest-v2/profile/transports");a.resetDriverLicenseState=function(){a.DLFindStatus=null,a.newDriverLicense={serial:"",number:""}},a.resetTransportState=function(){a.transportFindStatus=null,a.newTransport={techPassportNumber:"",number:""}},a.resetState=function(){a.resetDriverLicenseState(),a.resetTransportState()},a.addPenaltyWatcher=function(){return a.newAutoForm.$valid&&!a.newAutoForm.$error&&c.post(a.newTransport).then(function(b){"SUCCESS"===(null!==b?b.status:void 0)&&(a.getUpdate(null,"PP_TECH_INSPECTION"),a.show=!1,a.resetState())}),!1},a.getUpdate=function(b,c){a.update({k:b,t:c})}}],link:function(a){a.hideModal=function(){a.show=!1}},templateUrl:"../template/modals/modalAuto.html"}}),angular.module("myegovApp").directive("modalConfirmation",function(){return{restrict:"E",scope:{show:"=",actionType:"=",sectionType:"=",update:"&",fetch:"&"},replace:!0,controller:["$scope","commonRestangular","$rootScope",function(a,b){a.unsubscribeModal=function(c){b.one("person-profile/rest-v2/profile/unsubscribe/"+c).put().then(function(b){100===b.code?(a.getFetch(c),"PP_GOV_INTERACT"!==c&&("PP_CHILDREN"===c&&a.getFetch("PP_PRESCHOOL_QUEUE"),a.getFetch("PP_PROFILE")),a.show=!1):a.show=!1})},a.subscribeModal=function(c){a.$emit("showGlobalLoader"),b.one("person-profile/rest-v2/profile/subscribe/"+c).put().then(function(b){100===b.code?(a.getFetch(c),a.show=!1,"PP_GOV_INTERACT"!==c&&(a.getUpdate(c),a.getFetch("PP_PROFILE"))):a.show=!1})},a.getUpdate=function(b){a.update({t:b})},a.getFetch=function(b){a.fetch({t:b})}}],link:function(a,b,c){a.dialogStyle={},c.width&&(a.dialogStyle.width=c.width),c.height&&(a.dialogStyle.height=c.height),a.hideModal=function(){a.show=!1},a.$watch("sectionType",function(){a.showMessage=!a.actionType,a.startProcess=function(){a.actionType?(a.showMessage=!0,a.unsubscribeModal(a.sectionType)):(a.showMessage=!1,a.subscribeModal(a.sectionType))}})},templateUrl:"../template/modals/modalConfirmation.html"}}),angular.module("myegovApp").directive("modalDeleteUserCardConfirmation",function(){return{restrict:"E",scope:{show:"=",card:"=",usercards:"="},replace:!0,controller:["$scope","commonRestangular","$rootScope",function(a,b){a.deleteUserCard=function(){b.one("person-profile/rest-v2/profile/delete-pshep-user-card").put({cardId:a.card.cardID}).then(function(b){200===b.responseInfo.code?(a.usercards=b.userCards.cards,a.usercards.updateInfo=b.updateInfo,a.hideModal()):null!==b.responseInfo.message?toastr.error(i18n.translate("userCards.userCardDeleteError"),i18n.translate("userCards.deleteUserCardErrorCodes."+b.responseInfo.message)):toastr.error(i18n.translate("userCards.userCardDeleteError")),a.hideModal()})}}],link:function(a,b,c){a.dialogStyle={},c.width&&(a.dialogStyle.width=c.width),c.height&&(a.dialogStyle.height=c.height),a.hideModal=function(){a.show=!1}},templateUrl:"../template/modals/modalDeleteUserCardConfirmation.html"}}),function(){function a(a,b){function c(c,d,e,f){var g,h=angular.element(d),i=b.currentLanguage,j={format:"dd.mm.yyyy",todayHighlight:!0,autoclose:!0,keyboardNavigation:!1,orientation:"auto",forceParse:!0,weekStart:1,language:i,endDate:new Date};h.datepicker(j).on("show",function(){b.currentLanguage!==j.language&&(j.language=b.currentLanguage,h.datepicker("remove"),h.datepicker(j),h.datepicker("show"))}).on("hide",function(b){b.date?a(function(){f.$setViewValue(b.date.getTime())}):f.$setViewValue(void 0)}),g=c.$watch("ngModel",function(a){a?(h.datepicker("setDate",new Date(a)),c.onChange()):h.datepicker("update","")}),c.$on("$destroy",function(){h.datepicker("remove"),g()})}var d={require:"ngModel",restrict:"E",replace:!1,scope:{ngModel:"=",onChange:"&"},link:c,templateUrl:"../template/datepicker.html"};return d}angular.module("myegovApp").directive("wxDatepicker",a),a.$inject=["$timeout","$rootScope"]}();var cntrl="",kTokensNclayer=!1,idCardNclayer=!1,webSocket=null,heartbeatMsg="--heartbeat--",heartbeatInterval=null,missedHeartbeats=0,missedHeartbeatsLimitMin=3,missedHeartbeatsLimitMax=50,missedHeartbeatsLimit=missedHeartbeatsLimitMin,callback=null;$(document).ready(function(){var a=$(".js-login-tab"),b=$(".js-login-form");a.each(function(){var c=$(this),d=c.attr("href");c.on("click",function(){return b.fadeOut(80,function(){setTimeout(function(){$(d).fadeIn()},80)}),a.removeClass("active"),c.addClass("active"),!1})})}),angular.module("myegovApp").directive("modalAddRegion",function(){return{restrict:"E",scope:{show:"=",service:"=",update:"&",fetch:"&",iin:"="},replace:!0,controller:["$scope","commonRestangular","$rootScope",function(a,b){a.load=function(){b.all("person-profile/rest-v2/profile/region-code").post({serviceCode:"",regionCode:""}).then(function(b){a.showAlert=!1,b.regionCodeResponse&&(a.regionCodeList=b.regionCodeResponse.regionCodeRestList)}),a.showAddBtn=!1},a.changeParent=function(c){a.showAlert=!1,angular.isDefined(c)&&null!==c&&""!==c&&(c.haveChildrens?(a.isChild2Show=!1,a.showAddBtn=!1,b.all("person-profile/rest-v2/profile/region-code").post({serviceCode:a.service,regionCode:c.code}).then(function(b){a.isChild1Show=!0,a.regionCodeList1=b.regionCodeResponse.regionCodeRestList})):(a.showAddBtn=!0,a.data=c))},a.changeChild=function(c){a.showAlert=!1,angular.isDefined(c)&&null!==c&&""!==c&&(c.haveChildrens?(a.isChild2Show=!0,a.showAddBtn=!1,b.all("person-profile/rest-v2/profile/region-code").post({serviceCode:a.service,regionCode:c.code}).then(function(b){a.regionCodeList2=b.regionCodeResponse.regionCodeRestList})):(a.showAddBtn=!0,a.data=c))},a.changeSubChild=function(b){a.showAlert=!1,angular.isDefined(b)&&null!==b&&""!==b&&(b.haveChildrens?a.showAddBtn=!1:(a.showAddBtn=!0,a.data=b))},a.add=function(){"S007"===a.service?b.all("person-profile/rest-v2/profile/accommodation-queue").post({regionCode:a.data.code,regionNameRu:a.data.name.ruText,regionNameKk:a.data.name.kkText}).then(function(b){100===b.code?(a.show=!1,a.isChild1Show=!1,a.isChild2Show=!1,a.showAlert=!1,a.getFetch("PP_ACCOMMODATION_QUEUE"),a.getUpdate("PP_ACCOMMODATION_QUEUE")):131===b.code?a.showAlert=!0:a.show=!1}):"S001"===a.service&&b.all("person-profile/rest-v2/profile/preschool-queue").post({regionCode:a.data.code,regionNameRu:a.data.name.ruText,regionNameKk:a.data.name.kkText,childIin:a.iin}).then(function(b){100===b.code?(a.show=!1,a.isChild1Show=!1,a.isChild2Show=!1,a.showAlert=!1,a.getFetch("PP_PRESCHOOL_QUEUE"),a.getUpdate("PP_PRESCHOOL_QUEUE")):131===b.code?a.showAlert=!0:a.show=!1})},a.getUpdate=function(b){a.update({t:b})},a.getFetch=function(b){a.fetch({t:b})}}],link:function(a){a.hideModal=function(){a.show=!1,a.isChild1Show=!1,a.isChild2Show=!1,a.showAlert=!1},a.$watch("show",function(){a.show&&a.load()})},templateUrl:"../template/modals/modalAddRegion.html"}}),angular.module("myegovApp").directive("modalChildren",function(){return{restrict:"E",scope:{show:"=",fetch:"&"},replace:!0,controller:["$scope","commonRestangular",function(a,b){function c(a){var b,c,d=[1,2,3,4,5,6,7,8,9,10,11],e=[3,4,5,6,7,8,9,10,11,1,2],f=[],g=0;for(b=0;b<12;b++)f[b]=parseInt(a.substring(b,b+1),10),b<11&&(g+=f[b]*d[b]);if(g%=11,10===g){for(g=0,c=0;c<11;c++)g+=f[c]*e[c];g%=11}return g===f[11]}a.checkIin=function(b){a.reset(),angular.isDefined(b)&&""!==b&&null!==b&&12===b.length&&(a.showWarning=!c(b),a.showWarning||(a.searchShow=!0))},a.add=function(c){b.all("person-profile/rest-v2/profile/children").post(c).then(function(b){100===b.code?(a.getFetch("PP_CHILDREN"),a.show=!1,a.searchShow=!1,a.resetField()):131===b.code?(a.duplicate=!0,a.childFound=!1,a.notFound=!1,a.showWarning=!1,a.searchShow=!0):a.show=!1})},a.search=function(c){return a.reset(),a.child.$valid&&!a.child.$invalid&&b.one("person-profile/rest-v2/profile/children/"+c).put().then(function(b){100===b.responseInfo.code?(a.childInfo=b.childInfo,a.childName=b.childInfo.name,a.childSurName=b.childInfo.surname,a.childPatronymic=b.childInfo.patronymic,a.childFound=!0,a.searchShow=!1):(a.notFound=!0,a.searchShow=!0)}),!1},a.reset=function(){a.childFound=!1,a.showWarning=!1,a.notFound=!1,a.duplicate=!1,a.searchShow=!1;
},a.resetField=function(){a.childFound=!1,a.showWarning=!1,a.notFound=!1,a.duplicate=!1,a.searchShow=!1,a.searchShow=!1,a.newIin={childIin:""}},a.getFetch=function(b){a.fetch({t:b})}}],link:function(a){a.hideModal=function(){a.show=!1,a.resetField()}},templateUrl:"../template/modals/modalChildren.html"}}),function(){function a(a,b,c,d,e,f,g){function h(b){return function(c){(c||"0"===c)&&(b[c]=!b[c]),angular.forEach(b,function(d,e){e!==c&&(b[e]=!1),(c||"0"===c)&&d&&(a.UI.state.anyDropdownOpen=!0),c||"0"===c||(a.UI.state.anyDropdownOpen=!1)})}}function i(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)}function j(){q.get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code?(a.mail=b.contact.value,a.fullContact=b.contact,a.showEmail=!0):a.showEmail=!1})}function k(){b.one("legal-profile/rest/legal-profile-branch").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code?(a.legalEntityBranchList=b,a.legalProfileBranchList=b.legalProfileBranches,a.isLEBSectionEnabled=!0,a.isLEBSubsExist=!0,a.isLEBRestriction=!0):102===b.responseInfo.code||103===b.responseInfo.code?(a.isLEBSectionEnabled=!1,a.isLEBRestriction=!1):106===b.responseInfo.code?(a.isLEBSubsExist=!1,a.isLEBSectionEnabled=!1,a.isLEBMenuShow=!0,a.isLEBRestriction=!0):(a.isLEBSectionEnabled=!1,a.isLEBRestriction=!0),a.$emit("hideGlobalLoader")})}function l(){b.one("legal-profile/rest/legal-profile-participation").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code?(a.legalEntityParticipationList=b,a.legalProfileParticipationList=b.legalProfileParticipations,a.isLEPSectionEnabled=!0,a.isLEPSubsExist=!0,a.isLEPRestriction=!0):102===b.responseInfo.code||103===b.responseInfo.code?(a.isLEPSectionEnabled=!1,a.isLEPRestriction=!1):106===b.responseInfo.code?(a.isLEPSubsExist=!1,a.isLEPSectionEnabled=!1,a.isLEPMenuShow=!0,a.isLEPRestriction=!0):(a.isLEPSectionEnabled=!1,a.isLEPRestriction=!0),a.$emit("hideGlobalLoader")})}function m(){b.one("legal-profile/rest/legal-profile-realty").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code?(a.legalEntityRealtyList=b,a.isRealEstateSectionEnabled=!0,a.isRealEstateSubsExist=!0,a.isRealEstateRestriction=!0):102===b.responseInfo.code||103===b.responseInfo.code?(a.isRealEstateSectionEnabled=!1,a.isRealEstateRestriction=!1):106===b.responseInfo.code?(a.isRealEstateSubsExist=!1,a.isRealEstateSectionEnabled=!1,a.isRealEstateMenuShow=!0,a.isRealEstateRestriction=!0):(a.isRealEstateSectionEnabled=!1,a.isRealEstateRestriction=!0),a.$emit("hideGlobalLoader")})}function n(){b.one("legal-profile/rest/gov-interact").get().then(function(b){100===b.code||101===b.code?(a.isGovInteractSectionEnabled=!0,a.isGovInteractSubsExist=!0,a.isGovInteractRestriction=!0):102===b.code||103===b.code?(a.isGovInteractSectionEnabled=!1,a.isGovInteractRestriction=!1):106===b.code?(a.isGovInteractSubsExist=!1,a.isGovInteractSectionEnabled=!1,a.isGovInteractMenuShow=!0,a.isGovInteractRestriction=!0):(a.isGovInteractSectionEnabled=!1,a.isGovInteractRestriction=!0),a.$emit("hideGlobalLoader")})}function o(){var c,d;b.one("legal-profile/rest/licenses").get().then(function(b){100===b.responseInfo.code&&b.licenses.sort(function(a,b){return c=new Date(a.validityStartDate),d=new Date(b.validityStartDate),c<d?-1:c>d?1:0}),100===b.responseInfo.code||101===b.responseInfo.code||110===b.responseInfo.code?(a.licensesList=b,a.isLicenseSectionEnabled=!0,a.isLicenseSubsExist=!0):103===b.responseInfo.code?a.isLicenseSectionEnabled=!1:106===b.responseInfo.code?(a.isLicenseSubsExist=!1,a.isLicenseSectionEnabled=!1,a.isLicenseMenuShow=!0):102===b.responseInfo.code?a.isLicenseSectionOff=!0:a.isLicenseSectionEnabled=!1,a.$emit("hideGlobalLoader")})}function p(){b.one("legal-profile/rest/").get().then(function(b){a.legalprofile=b.legalProfile,a.initializeLP=!0,g.isProfileEnabled=b.legalProfile.enabled,135===b.responseInfo.code&&(g.initialize(),g.checkNss(),g.checkOneInBox(),g.checkMyDocs()),a.fetchSubscriptionCount(),k(),l(),m(),j(),n(),o(),a.$emit("hideGlobalLoader")})}var q=b.one("nss/rest-v2/settings/contact/mail");a.$emit("showGlobalLoader"),a.initializeLP=!1,a.registeredPersons=[],a.UI={state:{editingContacts:!1,confirmingEmail:!1,emailRemoved:!1,anyDropdownOpen:!1,dropdown:{legalProfile:!1},participation:!0,branchlist:!0,property:{advanced:!0}}},toastr.options={positionClass:"toast-top-right",timeOut:4e3},a.prepareDynamicData=function(a,b){var c,d;for(d=0;d<b.length;d++)c=a.replace("{"+d+"}",b[d]);return c},a.toggleDropdown=new h(a.UI.state.dropdown),a.regLegalProfileOptions=[{code:"registerLegalEntity",href:"http://egov.kz/services/P30.11/"},{code:"registredLegalEntity",href:"http://egov.kz/services/P30.01/"},{code:"availabilityOfArrest",href:"http://egov.kz/services/P30.08/"},{code:"absencePresenceLegalEntity",href:"http://egov.kz/services/P3.061/"}],a.oldMail="",a.toggleEditingContacts=function(){a.UI.state.editingContacts=!a.UI.state.editingContacts,a.oldMail=a.mail},a.cancelEditingContacts=function(){a.UI.state.editingContacts=!1,a.mail=a.oldMail},a.removeEmail=function(){q.remove().then(function(b){b!==!0&&"true"!==b||(a.UI.state.emailRemoved=!0)})},a.saveContacts=function(){i(a.mail)||(a.mail=a.oldMail,toastr.error(i18n.translate("profile.emailError"))),a.mail&&i(a.mail)&&(a.oldMail!==a.mail?(a.showEmail=!0,a.fullContact?null===a.fullContact.id?a.addEmail():a.updateEmail():a.addEmail()):a.UI.state.editingContacts=!1)},a.fetchSubscriptionCount=function(){b.one("legal-profile/rest/subscription-state").get().then(function(b){100===b.responseInfo.code||101===b.responseInfo.code?(g.allSubscriptionCount=b.allSubscriptionCount,g.subscriptionEnabledCount=b.subscriptionEnabledCount,g.subscriptionDisabledCount=b.subscriptionDisabledCount,g.permissionExist=!0):103===b.responseInfo.code&&(g.permissionExist=!1),a.$emit("hideGlobalLoader")})},a.addEmail=function(){b.all("nss/rest-v2/settings/contact/mail/"+a.mail).post().then(function(b){100===b.responseInfo.code?(toastr.success(i18n.translate("profile.confirmEmailInfo"),i18n.translate("profile.posted")),a.UI.state.editingContacts=!1,j()):toastr.error(i18n.translate("profile.contactSaveError"),i18n.translate("profile.connectionError"))})},a.updateEmail=function(){b.one("nss/rest-v2/settings/contact/mail/"+a.fullContact.id+"/"+a.mail).post().then(function(b){100===b.responseInfo.code?(toastr.success(i18n.translate("profile.confirmEmailInfo"),i18n.translate("profile.posted")),a.UI.state.editingContacts=!1,j()):toastr.error(i18n.translate("profile.contactSaveError"),i18n.translate("profile.connectionError"))})},a.reloadAll=function(c){c&&(c.target.parentNode.setAttribute("style","pointer-events: none"),setTimeout(function(){c.target.parentNode.setAttribute("style","pointer-events: all")},3e4)),a.$emit("showGlobalLoader"),b.one("legal-profile/rest/synchronize-all").get().then(function(){a.$emit("hideGlobalLoader")})},a.reloadService=function(c,d){d&&(d.target.parentNode.setAttribute("style","pointer-events: none"),setTimeout(function(){d.target.parentNode.setAttribute("style","pointer-events: all")},3e4)),a.$emit("showGlobalLoader"),b.one("legal-profile/rest/synchronize-section/"+c).get().then(function(){a.fetchSubscriptionCount(),a.$emit("hideGlobalLoader")})},a.$on("PP_LEGAL_GOV_INTERACT",n),a.$on("PP_LICENSE",o),a.$on("PP_PROFILE_LEGAL",p),a.fetchLegalServiceByName=function(b){"PP_PROFILE_LEGAL"===b?p():"PP_REALTY_LEGAL"===b?m():"PP_BRANCH_LEGAL"===b?k():"PP_PARTICIPATION_LEGAL"===b?l():"PP_LEGAL_GOV_INTERACT"===b?n():"PP_LICENSE"===b&&o(),a.fetchSubscriptionCount()},a.modalShow=!1,a.toggleModal=function(b,c){a.sectionType=b,a.actionType=c,a.modalShow=!0},a.$on("fetchLegalServiceByName",function(b,c){a.fetchLegalServiceByName(c)}),a.accessControl=function(){a.$emit("showGlobalLoader"),c.transitionTo("access-control")},g.disableLegalPersonProfile=function(){b.one("legal-profile/rest/disable-person-profile").get().then(function(){p()})},g.switchOnLegalPersonProfile=function(){b.one("legal-profile/rest/switch-on-person-profile").get().then(function(){p()})},p(),a.searchRegisteredPersonsByRealtyId=function(c){a.registeredPersons[c]?a.registeredPersons[c].visible=!a.registeredPersons[c].visible:b.one("legal-profile/rest/search-registered-persons/"+c).get().then(function(b){b&&(a.registeredPersons[c]=b),a.$emit("hideGlobalLoader")})},a.getTempAddressText=function(a){var b=new Date(a),c=b.getDate(),d=b.getMonth()+1;c<10&&(c="0"+c),d<10&&(d="0"+d);var e=c+"."+d+"."+b.getFullYear();return i18n.translate("profile.registeredTemp").replace("date",e)}}angular.module("myegovApp").controller("LegalEntityController",a),a.$inject=["$scope","commonRestangular","$state","$stateParams","$document","$window","$rootScope"]}(),function(){function a(a,b,c,d){function e(c){b.one("legal-profile/rest/section/"+c).get().then(function(b){var c;for(a.sections=b.sections.sectionList,c=0;c<a.sections.length;c++)a.sections[c].isPermissionExist&&a.items.push({sectionType:a.sections[c].sectionType,tableTypeNameRu:a.sections[c].sectionName.ruText,tableTypeNameKk:a.sections[c].sectionName.kkText,isChecked:a.sections[c].isPermissionExist})})}function f(){var b,c=a.legalEntityRealtyList.legalProfileRealtyList,d=0;for(b=0;b<c.length;b++)c[b].visible===!1&&d++;a.checkboxAll=!d,a.showListRealty&&a.checkboxAll&&0===d&&toastr.success(i18n.translate("profile.realtyOnAllCheckbox")),a.showListRealty&&!a.checkboxAll&&d===c.length&&toastr.info(i18n.translate("profile.realtOffAllCheckbox"))}function g(){b.one("legal-profile/rest/access-control-realty").get().then(function(b){100===b.responseInfo.code&&(a.legalEntityRealtyList=b,a.legalEntityRealtyList.legalProfileRealtyList.length>0&&f()),a.$emit("hideGlobalLoader")})}function h(){b.one("legal-profile/rest/user-restriction").get().then(function(b){a.restrictions=b.restrictions})}return a.$emit("hideGlobalLoader"),a.newIin={iin:""},a.items=[],a.showListRealty=!1,a.checkboxAll=!1,toastr.options={positionClass:"toast-top-right",timeOut:2e3},d.profileDisabled?c.transitionTo("profile-disabled"):(b.one("legal-profile/rest/check-leader").get().then(function(a){100!==a.code&&c.transitionTo("no-access")}),a.toggleCheckbox=function(a){var c=a.id,d=a.visible?b.one("legal-profile/rest/realty-visible/"+c):b.one("legal-profile/rest/realty-invisible/"+c);d.put().then(function(b){b&&(g(),a.visible?toastr.success(i18n.translate("profile.realtyOnCheckbox")):toastr.info(i18n.translate("profile.realtOffCheckbox")))})},a.checkSeen=function(){a.showListRealty=!0,b.one("legal-profile/rest/realty-seen").put()},a.toggleCheckboxAll=function(){var c=a.checkboxAll?b.one("legal-profile/rest/realty-visible-all"):b.one("legal-profile/rest/realty-invisible-all");c.put().then(function(a){a&&g()})},a.find=function(c){a.$emit("showGlobalLoader"),b.one("legal-profile/rest/find-person-profile/"+c).get().then(function(b){a.$emit("hideGlobalLoader"),100===b.responseInfo.code?(a.personProfile=b,a.found=!0,a.notFound=!1,e(b.personProfile.iin)):(a.notFound=!0,a.found=!1)})},a.isChecked=function(b){var c,d=!1;for(c=0;c<a.sections.length;c++)a.sections[c].sectionType===b&&a.sections[c].isPermissionExist&&(d=!0,a.isPermissionExist=!0);return d},a.sync=function(b,c){var d;if(b)a.items.push({sectionType:c.sectionType,tableTypeNameRu:c.sectionName.ruText,tableTypeNameKk:c.sectionName.kkText,isChecked:b});else for(d=0;d<a.items.length;d++)a.items[d].sectionType===c.sectionType&&a.items.splice(d,d+1)},a.reset=function(){a.newIin={iin:""},a.items=[],a.found=!1,a.notFound=!1},a.add=function(){a.adding=!0,b.all("legal-profile/rest/add-user-restriction").post({iin:a.personProfile.personProfile.iin,name:a.personProfile.personProfile.name,surname:a.personProfile.personProfile.surname,patronymic:a.personProfile.personProfile.patronymic,sectionList:a.items}).then(function(b){a.adding=!1,100===b.code?(toastr.success(i18n.translate("restriction.restrictionSuccessAdded")),a.reset(),h()):101===b.code&&toastr.success(i18n.translate("restriction.noSectionSelected"))})},a["delete"]=function(a){b.one("legal-profile/rest/user-restriction/"+a).remove().then(function(){h()})},h(),void g())}angular.module("myegovApp").controller("AccessControlController",a),a.$inject=["$scope","commonRestangular","$state","$rootScope"]}(),function(){function a(){function a(a){a.hideModal=function(){a.show=!1,a.vm.reset()},a.$watch("show",function(){a.show&&a.vm.init()})}function b(a,b,c,d){function e(){q.documentTypeList||g()}function f(){q.category=null,q.subcategory=null,q.code=null,r=null,q.fileuploaded=!1,q.title="",q.documentTypeSubList=[],q.disabled=!0}function g(){b.getUploadCategories().then(function(a){a.documentTypeList&&(q.documentTypeList=a.documentTypeList)})}function h(a){q.subcategory=null,a&&a.code&&(a.hasChildren?(q.code=null,b.getUploadSubCategories(a.code).then(function(a){a.documentTypeList&&(q.documentTypeSubList=a.documentTypeList,q.disabled=!1)})):q.code=a.code)}function i(a){q.code=a&&a.code?a.code:null}function j(a){var b,c="",e=new Uint8Array(a),f=e.byteLength;for(b=0;b<f;b++)c+=String.fromCharCode(e[b]);return d.btoa(c)}function k(a){var b=a.name.toLowerCase(),c=".html";if(b.includes(c))return!1;var d,e=a.name.substr(a.name.lastIndexOf(".")+1).toLowerCase(),f=["pdf","jpeg","jpg","gif","png","bmp","doc","docx","xls","xlsx"];for(d=0;d<f.length;d++)if(f[d]===e)return!0;return!1}function l(b){var c=new FileReader,d=b[0];k(d)?d.size>0&&d.size<=a.size?(c.readAsArrayBuffer(d),c.onload=function(b){r=j(b.target.result),d.name&&m(d.name.substr(0,d.name.lastIndexOf("."))),q.fileuploaded=!q.fileuploaded,a.$apply()}):toastr.error(i18n.translate("mydoc.sizeError")):toastr.error(i18n.translate("profile.notSupportFormatInfo"))}function m(a){q.title=a.replace(/[\/\\:*?"<>|]/g,"")}function n(){var a={};q.title&&r&&q.code?(q.loading=!0,a={documentName:q.title,documentType:q.code,content:r},c.uploadDocument(a).then(function(a){q.loading=!1,100===a.code?(o(),toastr.success(i18n.translate("profile.saveDocument"))):136===a.code?toastr.error(i18n.translate("mydoc.maxSizeError")):137===a.code?toastr.error(i18n.translate("mydoc.storageIsFull")):toastr.error(i18n.translate("profile.error110"))},function(){q.loading=!1,o(),toastr.error(i18n.translate("profile.saveErrorDocument"))})):toastr.error(i18n.translate("profile.errorDocInput"))}function o(){a.fetch(),a.hideModal()}function p(){q.title="",r=null,q.fileuploaded=!q.fileuploaded}var q=this,r=null;q.init=e,q.changeCategory=h,q.changeSubCategory=i,q.selectFile=l,q.save=n,q.deleteFile=p,q.reset=f,q.fileuploaded=!1,q.disabled=!0,q.code=null,q.title="",q.loading=!1,q.checkTitle=m}var c={restrict:"E",scope:{show:"=",size:"=",fetch:"&"},templateUrl:"../template/modals/modalAddFile.html",replace:!0,controller:b,controllerAs:"vm",link:a};return b.$inject=["$scope","DocsCategories","MydocService","$window"],c}angular.module("myegovApp").directive("modalAddFile",a)}(),angular.module("myegovApp").directive("timeline",function(){return{restrict:"E",templateUrl:"../template/timeline.html",controller:["$scope","commonRestangular","$rootScope",function(a,b){function c(a){var b=a.charAt(6);return!!(1&b)}function d(){a.timelineLoading=!0,b.one("/person-profile/rest-v2/profile/timeline").get().then(function(b){100===b.responseInfo.code?(a.timelineArray=b.timelineInfo,a.sex=c(b.responseInfo.iinbin),a.showTimeline=!0,a.timelineLoading=!1):103===b.responseInfo.code?(a.showTimeline=!1,a.timelineLoading=!1):toastr.error(i18n.translate("profile.error110"))})}d()}]}}),function(){function a(){function a(a){function b(){a.percent=Math.round(100*a.value/a.max)+"%"}function c(){b()}c()}var b={restrict:"E",scope:{max:"=",value:"="},templateUrl:"../template/progressbar.html",link:a};return b}angular.module("myegovApp").directive("progressbar",a)}(),angular.module("myegovApp").directive("legalModalConfirmation",function(){return{restrict:"E",scope:{show:"=",actionType:"=",sectionType:"=",update:"&",fetch:"&"},replace:!0,controller:["$scope","commonRestangular","$rootScope",function(a,b){a.unsubscribeModal=function(c){b.one("legal-profile/rest/unsubscribe/"+c).put().then(function(b){100===b.code?(a.getFetch(c),a.show=!1):a.show=!1})},a.subscribeModal=function(c){a.$emit("showGlobalLoader"),b.one("legal-profile/rest/subscribe/"+c).put().then(function(b){100===b.code?(a.getFetch(c),"PP_LEGAL_GOV_INTERACT"!==c&&a.getUpdate(c),a.show=!1):a.show=!1})},a.getUpdate=function(b){a.update({t:b})},a.getFetch=function(b){a.fetch({t:b})}}],link:function(a,b,c){a.dialogStyle={},c.width&&(a.dialogStyle.width=c.width),c.height&&(a.dialogStyle.height=c.height),a.hideModal=function(){a.show=!1},a.$watch("sectionType",function(){a.showMessage=!a.actionType,a.startProcess=function(){a.actionType?(a.showMessage=!0,a.unsubscribeModal(a.sectionType)):(a.showMessage=!1,a.subscribeModal(a.sectionType))}})},templateUrl:"../template/modals/legalModalConfirmation.html"}}),function(){function a(a){function b(b,c){function d(){var b=63;a.pageYOffset>=b?e.addClass("is_fixed"):e.removeClass("is_fixed")}var e=angular.element(c).find(".js_sticky-header");angular.element(a).bind("scroll",d)}function c(a,b){function c(){a.checkedCounter={MYEGOV:0,EMAIL:0,SMS:0,PUSH:0}}function d(){o.get().then(function(b){100===b.responseInfo.code?a.channelList=b.channelList:toastr.error(i18n.translate("profile.error110"))})}function e(){a.loading=!0,j.get().then(function(b){b.responseInfo&&(100===b.responseInfo.code&&b.notificationCategories.length&&(a.notifyList=b),a.loading=!1)})}function f(){m.get().then(function(b){var c;if(100===b.responseInfo.code)for(c=0;c<b.channelCountList.length;c++)a.commonCounter[b.channelCountList[c].channelType]=b.channelCountList[c].count;else toastr.error(i18n.translate("profile.error110"))})}function g(b){a.$emit("showGlobalLoader"),l.put({channelId:b}).then(function(c){100===c.code?(d(),a.fetchSubscriptions(),1===b&&a.update()):toastr.error(i18n.translate("profile.error110")),a.$emit("hideGlobalLoader")})}function h(b){a.$emit("showGlobalLoader"),n.put({channelId:b}).then(function(c){100===c.code?(d(),a.fetchSubscriptions(),1===b?(toastr.success(i18n.translate("billing.smsEnabled")),a.update()):toastr.success(i18n.translate("billing.pushEnabled"))):122===c.code?toastr.error(i18n.translate("billing.notRegisterSMS")):120===c.code?toastr.error(i18n.translate("billing.notCorfirm")):119===c.code?toastr.error(i18n.translate("billing.errorSmsEnabled")):118===c.code?toastr.error(i18n.translate("billing.errorChannelEnabled")):123===c.code?toastr.error(i18n.translate("billing.errorAppNotInstall")):121===c.code?toastr.error(i18n.translate("billing.errorPhoneNotFound")):134===c.code&&toastr.error(i18n.translate("billing.phoneLocked")),a.$emit("hideGlobalLoader")})}function i(){c(),f(),d(),e(),a.fetchSubscriptions()}var j=b.one("nss/rest-v2/subscription/notification-category"),k=b.one("nss/rest-v2/subscription/subscribes"),l=b.one("nss/rest-v2/subscription/channel-unsubscribe"),m=b.one("nss/rest-v2/subscription/channels-count"),n=b.one("nss/rest-v2/subscription/channel-subscribe"),o=b.one("nss/rest-v2/subscription/channels");a.loading=!1,a.channelTypes={MYEGOV:!0,EMAIL:!0,SMS:!1,PUSH:!1},a.allSelectedInChannel={MYEGOV:!1,EMAIL:!1,SMS:!1,PUSH:!1},a.commonCounter={MYEGOV:0,EMAIL:0,SMS:0,PUSH:0},a.SMSSubscriptionModal={isVisible:!1,isAgreed:!1,show:function(){this.isVisible=!0,this.isAgreed=!1},hide:function(){this.isVisible=!1,this.isAgreed=!1,a.channelTypes.SMS=!1},agree:function(){this.isVisible=!1,this.isAgreed=!0,a.channelTypes.SMS=!1,h(1)}},a.fetchSubscriptions=function(){k.get().then(function(b){c(),a.subscriptions=b.subscriptionList})},a.toggleAllChannels=function(c){var d=b.one("nss/rest-v2/subscription/subscribeall/"+c.id),e=b.one("nss/rest-v2/subscription/unsubscribeall/"+c.id),f=a.allSelectedInChannel[c.channelType];f?d.put().then(function(b){100===b.code?a.fetchSubscriptions():toastr.error(i18n.translate("profile.error110"))}):e.put().then(function(b){100===b.code?a.fetchSubscriptions():toastr.error(i18n.translate("profile.error110"))})},a.globalSubscribe=function(b){"MYEGOV"!==b.channelType&&"EMAIL"!==b.channelType&&(b.mbcEnabled?g(b.id):1===b.id?(a.channelTypes.SMS=!1,a.allSelectedInChannel.SMS=!1,a.SMSSubscriptionModal.show()):h(b.id))},a.subscribe=function(c,d,e){a.$emit("showGlobalLoader"),e?b.one("nss/rest-v2/subscription/subscribe").put({channelId:c,notificationTypeId:d}).then(function(b){a.$emit("hideGlobalLoader"),100===b.code?a.fetchSubscriptions():toastr.error(i18n.translate("profile.error110"))}):b.one("nss/rest-v2/subscription/unsubscribe").put({channelId:c,notificationTypeId:d}).then(function(b){a.$emit("hideGlobalLoader"),100===b.code?a.fetchSubscriptions():toastr.error(i18n.translate("profile.error110"))})},i()}var d={restrict:"E",scope:{update:"&"},replace:!0,templateUrl:"../template/subscription.html",link:b,controller:c};return c.$inject=["$scope","commonRestangular"],d}angular.module("myegovApp").directive("subscription",a),a.$inject=["$window"]}(),function(){function a(a){function b(b,c){function d(){var b=!1,d=!1,e=angular.element(a).height(),g=c[0].clientHeight,h=angular.element(".js_height").height();g>e&&h>e||g>h?(f||(f=g),d=!1,b=!(h<=f)&&!(g-e>a.pageYOffset)):(b=!1,d=!0,f=g),b?c.addClass("is_fixed"):c.removeClass("is_fixed"),d?c.addClass("is_full"):c.removeClass("is_full")}var e,f;c[0].clientHeight>0&&(angular.element(a).bind("scroll",d),angular.element(a).bind("resize",function(){(c[0].className.indexOf("is_fixed")||c[0].className.indexOf("is_full"))&&(c.removeClass("is_fixed"),c.removeClass("is_full")),clearTimeout(e),e=a.setTimeout(d,100)}))}var c={restrict:"A",link:b};return c}angular.module("myegovApp").directive("stickySidebar",a),a.$inject=["$window"]}(),function(){function a(a){function b(b){b.agree=function(){return a.location=idpUrl+"?lvl=7&url="+encodeURIComponent(location.href),a.location},b.hide=function(){b.show=!1}}var c={restrict:"E",scope:{show:"="},replace:!0,templateUrl:"../template/modals/modalEds.html",link:b};return c}angular.module("myegovApp").directive("modalEds",a),a.$inject=["$window"]}(),function(){function a(a){function b(){return h.get()}function c(a){return g.get(a)}function d(a){return i.remove(a)}function e(a){return j.post(a)}function f(){return k.get()}var g=a.one("mydocs/rest-v2/document-list"),h=a.one("mydocs/rest-v2/check"),i=a.one("mydocs/rest-v2/document"),j=a.all("mydocs/rest-v2/upload-file"),k=a.one("person-profile/rest-v2/profile/check-user"),l={getPermission:b,getDocuments:c,deleteDocument:d,uploadDocument:e,getCheckUser:f};return l}angular.module("myegovApp").factory("MydocService",a),a.$inject=["commonRestangular"]}(),function(){function a(){function a(a,b,c){function d(){e()}function e(){m.categoriyList||c.getCategories().then(f)}function f(a){a.responseInfo&&a.documentTypeList&&(135!==a.responseInfo&&(m.categoriyList=a.documentTypeList,n.parent||g()),n.parent&&h(n.parent))}function g(){var a=m.categoriyList?m.categoriyList.length:0,c={},d={},e={name:{enText:"All",kkText:"Барлығы",ruText:"Все"}};if(b.params.page&&(n.page=b.params.page,m.page=n.page),b.params.start&&(n.start=parseInt(b.params.start,10),m.startDate=parseInt(b.params.start,10)),b.params.end&&(n.end=parseInt(b.params.end,10),m.endDate=parseInt(b.params.end,10)),b.params.attribute&&(n.attribute=b.params.attribute,m.attribute=n.attribute),b.params.parent){for(n.parent=b.params.parent,c.numb=0;c.numb<a;c.numb++)if(m.categoriyList[c.numb].code===n.parent){c.index=c.numb;break}if(m.parent=m.categoriyList[c.index],m.parent.hasChildren){for(m.subCategoryList.length>1&&m.subCategoryList.unshift(e),d.numb=0;d.numb<m.subCategoryList.length;d.numb++)if(b.params.type===m.subCategoryList[d.numb].code){d.index=d.numb;break}m.type=m.subCategoryList[d.index]}}}function h(a){c.getSubCategories(a).then(function(a){m.disabled=!1,m.subCategoryList=a.documentTypeList,g()})}function i(){var a=b.params.page?Number(b.params.page):1;(m.parent||m.type||m.attribute||m.startDate||m.endDate||a>1)&&(m.parent=null,m.type=null,m.attribute=null,m.startDate=null,m.endDate=null,m.subCategoryList=[],m.disabled=!0,b.transitionTo(b.current.name,{page:1},{reload:!1,notify:!1}).then(function(){l()}))}function j(a){h(a),n.type="",m.type="",k()}function k(){var a=m.parent?m.parent.code:b.params.parent,c=m.type?m.type.code:"";m.endDate&&m.endDate<m.startDate&&(m.startDate=m.endDate),b.transitionTo(b.current.name,{page:m.page,start:m.startDate,end:m.endDate,parent:a,type:c,attribute:m.attribute},{reload:!1,notify:!1}).then(function(){l()})}function l(){a.fetch()}var m=this,n=b.params;m.attributeArray=["GENERATED","UPLOAD"],m.clearFilter=i,m.selectCategory=j,m.updateDocList=k,m.disabled=!0,d()}var b={restrict:"E",templateUrl:"../views/mydoc/filter.html",scope:{fetch:"&"},controller:a,controllerAs:"vm"};return a.$inject=["$scope","$state","DocsCategories"],b}angular.module("myegovApp").directive("filter",a)}(),function(){function a(a){function b(){return f.get()}function c(a){return f.get({type:a})}function d(){return g.get()}function e(a){return g.get({type:a})}var f=a.one("mydocs/rest-v2/document-types"),g=a.one("mydocs/rest-v2/upload-document-types"),h={getCategories:b,getSubCategories:c,getUploadCategories:d,getUploadSubCategories:e};return h}angular.module("myegovApp").factory("DocsCategories",a),a.$inject=["commonRestangular"]}(),function(){function a(){function a(a){a.fetchMyDocs=function(){a.fetch()},a.$watch("update",function(){a.vm.getStorageInfo()})}function b(a){function b(){e.addFileVisible=!e.addFileVisible}function c(){a.get().then(d)}function d(a){a.storage&&100===a.responseInfo.code&&(e.storage=a.storage)}var e=this;e.toggleAddfileModal=b,e.addFileVisible=!1,e.getStorageInfo=c}var c={restrict:"E",templateUrl:"../views/mydoc/storage.html",scope:{fetch:"&",update:"="},controller:b,controllerAs:"vm",link:a};return b.$inject=["StorageService"],c}angular.module("myegovApp").directive("storage",a)}(),function(){function a(a){function b(){return c.get()}var c=a.one("mydocs/rest-v2/storage"),d={get:b};return d}angular.module("myegovApp").factory("StorageService",a),a.$inject=["commonRestangular"]}(),function(){function a(a){a.setBaseUrl(baseUrl),a.setDefaultHeaders({"Content-Type":"application/json; charset=utf-8;"})}function b(a){return a.withConfig(function(a){a.setBaseUrl(idpRestUrl)})}function c(a,b,c,d){return a.withConfig(function(a){a.setBaseUrl(baseUrl),a.setErrorInterceptor(function(a){if(997===a.status)return a.data={status:!1,description:"Head/leader of company only can create profile"},b.globalLoader=!1,c.transitionTo("lp-not-found");if(996===a.status)return a.data={status:!1,description:"Legal Profile disabled!"},b.globalLoader=!1,b.profileDisabled=!0,c.transitionTo("profile-disabled");if(998===a.status)return a.data={status:!1,description:"Profile disabled!"},b.globalLoader=!1,b.profileDisabled=!0,c.transitionTo("profile-disabled");if(403===a.status){if(c.$current.name.length>0&&"welcome"!==c.current.name)return d.location=idpUrl+"?lvl="+a.headers().nl+"&url="+encodeURIComponent(location.href),d.location}else 902===a.status&&(toastr.options={positionClass:"toast-top-right"},b.globalLoader=!1,toastr.error(i18n.translate("profile.serviceNotAvailable")));return null})})}function d(a){return a.withConfig(function(a){a.setBaseUrl(dialogUrl),a.setDefaultHttpFields({withCredentials:!0,crossDomain:!0})})}angular.module("myegovApp").config(a).factory("IdpRestangular",b).factory("commonRestangular",c).factory("pollRestangular",d),a.$inject=["RestangularProvider"],b.$inject=["Restangular"],c.$inject=["Restangular","$rootScope","$state","$window"],d.$inject=["Restangular"]}(),function(){function a(){function a(a){var b="20px",c="#555";a.link="#svg-"+a.label,a.iconWidth=a.width?a.width:b,a.iconHeight=a.height?a.height:b,a.iconFill=a.fill?a.fill:c}var b={restrict:"E",replace:!0,scope:{label:"@",width:"@",height:"@",fill:"@"},link:a,templateUrl:"../template/icon.html"};return b}angular.module("myegovApp").directive("icon",a)}(),function(){function a(){var a={restrict:"E",replace:!0,templateUrl:"../template/poll.html"};return a}angular.module("myegovApp").directive("poll",a)}(),function(){function a(){return function(a){return a?a.toLowerCase().charAt(0).toUpperCase()+a.toLowerCase().substr(1):a}}function b(){return function(a){var b;return null!==a&&(b=a.toLowerCase()),b.substring(0,1).toUpperCase()+b.substring(1)}}function c(){return function(a){return a?replaceAll(a,","," "):a}}function d(){return function(a){return a&&angular.isString(a)?a.trim():a}}function e(a){var b,c=a.split(/(\s|-)+/),d=[];for(b=0;b<c.length;b+=1)d.push(c[b][0].toUpperCase()+c[b].toLowerCase().substr(1));return d.join("")}function f(){return function(a){return a?e(a):a}}function g(){return function(a){var b;return null!==a&&(b=a.toLowerCase()),b}}function h(){return function(a){return!!a&&!(null===a.kkText||null===a.ruText)}}function i(){return function(a){var b=1024,c=["kB","MB","GB","TB","PB","EB","ZB","YB"],d=-1,e=a;if(Math.abs(a)<b)return a+" B";do e/=b,++d;while(Math.abs(e)>=b&&d<c.length-1);return e.toFixed(1)+" "+c[d]}}function j(a){return function(b){return a.trustAsHtml(b)}}function k(){return function(a,b){var c;return c=a.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,""),c=c.replace(/(\r\n|\n|\r)/gm," "),c.substring(0,b)}}function l(a){return function(b){var c,d;return b?(d=function(a){return a?a:b.kkText?b.kkText:b.ruText},c="kk"===a.currentLanguage?b.kkText:"ru"===a.currentLanguage?b.ruText:b.enText,d(c)):b}}function m(a){return function(b){var c,d;return b?(d=function(a){return a?a:b.kk?b.kk:b.ru},c="kk"===a.currentLanguage?b.kk:"ru"===a.currentLanguage?b.ru:b.en,d(c)):b}}function n(a){var b=a||"";return b.length<2?b:2===b.length?b[0].toUpperCase()+b[1].toUpperCase()+b.slice(2):b[0].toUpperCase()+b.slice(1)}function o(a){var b,c=a.toLowerCase()||"",d=c.match(/\S+/g);for(b=0;b<d.length;b++)d[b]=n(d[b]);return d.join(" ")}function p(){return function(a){return a?o(a):a}}function q(){return function(a,b){var c;if(a){if("fromNow"===b)return moment(new Date(a)).fromNow();if("fromNowTrue"===b)return moment(new Date(a)).fromNow(!0);if("spent"===b)return moment(new Date((new Date).valueOf()+a)).fromNow(!0);if("human"===b)return c=a&&"."===a[2]?a.replace(/(\d{2}).(\d{2}).(\d{4})/,"$2/$1/$3"):a,moment(c).format("D MMMM YYYY");if("humanStr"===b)return moment(a,"D.MM.YYYY").format("D MMMM YYYY");if("humanShort"===b)return moment(new Date(a)).format("D MMM YYYY");if("remaining"===b)return moment.duration(new Date(a)-new Date).humanize();if("short"===b)return moment(new Date(a)).format("D.MM.YY")}return a}}function r(){return function(a,b){return a?moment(a,b):a}}function s(){return function(a,b){return a&&"remaining"===b?new Date(a)-new Date:a}}function t(){return function(a){var b="";return a&&(moment.relativeTimeThreshold("d",32),b=moment.duration({days:a}).humanize()),b}}function u(){return function(a){var b="";return a&&(moment.relativeTimeThreshold("M",13),b=moment.duration(a,"months").humanize()),b}}angular.module("myegovApp").filter("capitalize",a).filter("capitalizeFirstLetter",b).filter("spaceInNumber",c).filter("trim",d).filter("capitalizeAfterHyphens",f).filter("lowerCase",g).filter("isNotNull",h).filter("humanSize",i).filter("unsafe",j).filter("npreview",k).filter("i18negov",l).filter("i18nEgovHistory",m).filter("capitalizeEachWordAndAbbr",p).filter("moment",q).filter("stringToDate",r).filter("dateChange",s).filter("amDays",t).filter("amMonths",u),j.$inject=["$sce"],l.$inject=["$rootScope"],m.$inject=["$rootScope"]}();